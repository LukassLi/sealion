{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\controller/assets\\scripts\\controller\\Revival.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["// Copyright (C) 2019, Flickering Inc. All rights reserved.\r\n// Author: hongchangfu (hongchangfu@flickering.ai)\r\n\r\n//复活\r\n\r\ndeclare const wx: any;\r\n\r\nimport MySound, { AudioType } from \"../MySound\";\r\nimport GameCtrl from \"./GameCtrl\";\r\nimport RootNode, { postMessageName } from \"../RootNode\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Revival extends cc.Component {\r\n    @property({ type: cc.Node, visible: true, displayName: \"复活分享\" })\r\n    private revivalBtn: cc.Node = undefined;\r\n\r\n    @property({ type: cc.Node, visible: true, displayName: \"点击跳过\" })\r\n    private skipBtn: cc.Node = undefined;\r\n\r\n    @property({ type: cc.Label, visible: true, displayName: \"分数\" })\r\n    private scoreLabel: cc.Label = undefined;\r\n\r\n    /** 激励视频 */\r\n    private videoAd: any = undefined;\r\n\r\n    start() {\r\n        this.addEventListener();\r\n    }\r\n\r\n    /**\r\n     * 面板打开\r\n     */\r\n    public open() {\r\n        this.node.active = true;\r\n        let score = GameCtrl.instance.Score.toString();\r\n        this.scoreLabel.string = score;\r\n        RootNode.instance.postMessage(postMessageName.revival, score);\r\n        RootNode.instance.fadeIn(0.3);\r\n        this.node.runAction(cc.fadeIn(0.3));\r\n        if (this.videoAd != undefined)\r\n            this.videoAd.load();\r\n    }\r\n\r\n    /**\r\n     * 面板关闭\r\n     */\r\n    public close() {\r\n        RootNode.instance.postMessage(postMessageName.revivalBack, undefined);\r\n        this.node.active = false;\r\n    }\r\n\r\n    /**\r\n     * 是否有复活\r\n     */\r\n    public canRevival():boolean\r\n    {\r\n        if(wx.createRewardedVideoAd && !RootNode.instance.isKid)\r\n            return true;\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 复活操作\r\n     */\r\n    private revivalOperation() {\r\n        this.node.active = false;\r\n        RootNode.instance.postMessage(postMessageName.revivalBack, undefined);\r\n        GameCtrl.instance.maskPanl.active = false;\r\n        GameCtrl.instance.revivalTime = 0;\r\n        GameCtrl.instance.revivalInit();\r\n        RootNode.instance.gameLog.recordAction(\"revival\");\r\n    }\r\n\r\n    /**\r\n     * 监听按钮,渐变过程不能点击按钮\r\n     */\r\n    private addEventListener() {\r\n        this.revivalBtn.on(\"click\", () => {\r\n            if (this.node.opacity < 255) {\r\n                return;\r\n            }\r\n            MySound.instance.playAudio(AudioType.Button);\r\n            this.revival();\r\n        });\r\n\r\n        this.skipBtn.on(\"click\", () => {\r\n            if (this.node.opacity < 255) {\r\n                return;\r\n            }\r\n            MySound.instance.playAudio(AudioType.Button);\r\n            this.skip();\r\n        })\r\n\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        //不是儿童版时创建激励视频\r\n        if (wx.createRewardedVideoAd && !RootNode.instance.isKid) {\r\n            this.videoAd = wx.createRewardedVideoAd({\r\n                adUnitId: 'adunit-e8ea267b5679a9c8'\r\n            })\r\n            this.videoAd.onClose((res) => {\r\n                if (res.isEnded != undefined && res.isEnded == false)\r\n                    return;\r\n                this.revivalOperation();\r\n            })\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 分享复活\r\n     */\r\n    private revival() {\r\n        if (this.videoAd != undefined) {\r\n            this.videoAd.show().catch(err => {\r\n                this.videoAd.load();\r\n            })\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 跳过\r\n     */\r\n    private skip() {\r\n        this.node.active = false;\r\n        RootNode.instance.postMessage(postMessageName.revivalBack, undefined);\r\n        GameCtrl.instance.gameFinish.open(true);\r\n    }\r\n}"]}