{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\MySound.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Copyright (C) 2019, Flickering Inc. All rights reserved.\r\n// Author: hongchangfu (hongchangfu@flickering.ai)\r\n\r\n//控制音效\r\n\r\ndeclare const wx: any;\r\n\r\nimport { effectVolume } from \"./GameConfig\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nexport const enum AudioType {\r\n    GameBgm = 0,              //游戏背景音乐\r\n    ComboGood = 1,          //combo good 音效\r\n    ComboTen = 2,          //连击为10\r\n    Finish = 3,             //结束面板\r\n    FinishRecordBreak = 4,  //结束破纪录\r\n    GameEnter = 5,          //进入游戏\r\n    GameOver = 6,           //游戏结束\r\n    GreaterThanTen = 7,     //合成超过10\r\n    GreaterThanFifteen = 8, //合成超过15\r\n    LessThanTen = 9,        //合成小于10\r\n    Split = 10,             //分开\r\n    Ten = 11,               //合成10\r\n    Button = 12,            //按钮\r\n    DropNum1 = 13,          //下落数字1   \r\n    DropNum2 = 14,          //下落数字2 \r\n    DropNum3 = 15,          //下落数字3 \r\n    DropNum4 = 16,          //下落数字4     \r\n    DropNum5 = 17,          //下落数字5 \r\n    DropNum6 = 18,          //下落数字6 \r\n    DropNum7 = 19,          //下落数字7 \r\n    DropNum8 = 20,          //下落数字8 \r\n    DropNum9 = 21,          //下落数字9 \r\n    CrazyFive = 22,         //疯狂模式切入\r\n    CrazyFiveBgm = 23,      //疯狂模式的背景音乐\r\n    ComboTen1 = 24,         //连击为10 1\r\n    ComboTen2 = 25,         //连击为10 2\r\n    PlayAgain = 26,         //复活音效\r\n}\r\n\r\n@ccclass\r\nexport default class MySound extends cc.Component {\r\n    @property({ type: [cc.AudioClip], visible: true, displayName: \"音效\" })\r\n    public clipArr: Array<cc.AudioClip> = [];\r\n\r\n    public static instance: MySound = undefined;\r\n\r\n    /** 是否静音 */\r\n    private mute: boolean = false;\r\n\r\n    /** 背景id */\r\n    private bgmId: number = -100;\r\n\r\n    /** 疯狂背景id */\r\n    private crazyBgmId: number = -100;\r\n\r\n    /** 连10 三个音效随机 */\r\n    private tenArr = [2, 24, 25];\r\n\r\n    /** 微信播放声音实例数组 */\r\n    private audioArr = [];\r\n\r\n    /** 背景音效是否为疯狂背景 */\r\n    private isCrazy: boolean = false;\r\n\r\n    onLoad() {\r\n        MySound.instance = this;\r\n        cc.game.addPersistRootNode(this.node);\r\n        this.setIosMuteSwitch();\r\n        this.initWxAudio();\r\n        this.initMute();\r\n        this.setBgm();\r\n    }\r\n\r\n    /**\r\n     * 初始化微信音效实例\r\n     */\r\n    private initWxAudio() {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n        for (let i = 0; i < 27; i++) {\r\n            let audio = wx.createInnerAudioContext();\r\n            audio.src = wxDownloader.REMOTE_SERVER_ROOT + \"/\" + this.getNativeurl(i);\r\n            if (i == AudioType.GameBgm || i == AudioType.CrazyFiveBgm)\r\n                audio.loop = true;\r\n            audio.volume = effectVolume[i];\r\n            this.audioArr.push(audio);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取音频的勾选md5 后文件名\r\n     * @param num 第几个音频\r\n     */\r\n    private getNativeurl(num: number): string {\r\n        let url = this.clipArr[num].nativeUrl;\r\n        if (cc.loader.md5Pipe == null)\r\n            return url;\r\n        let length = url.length;\r\n        let index = url.lastIndexOf('/') + 1;\r\n        let id = url.substring(index, length - 4);\r\n        let md51 = cc.loader.md5Pipe.md5AssetsMap[id];\r\n        let md52 = cc.loader.md5Pipe.md5NativeAssetsMap[id];\r\n        let md5 = md51 == undefined ? md52 : md51;\r\n        if (md5 != undefined)\r\n            url = url.substring(0, length - 4) + \".\" + md5 + \".mp3\";\r\n        return url;\r\n    }\r\n\r\n\r\n    /**\r\n     * 设置ios静音模式下播放声音\r\n     */\r\n    private setIosMuteSwitch() {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        //存在该接口\r\n        if(wx.setInnerAudioOption)\r\n        {\r\n            wx.setInnerAudioOption({\r\n                obeyMuteSwitch: false,\r\n                success() {\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 初始读取音效开关\r\n     */\r\n    private initMute() {\r\n        // 读取本地音效开关变量\r\n        if (window.localStorage) {\r\n            let isMutStorage = window.localStorage.getItem('number_sprite_isMut');\r\n            this.mute = isMutStorage != undefined ? (isMutStorage == 'yes' ? true : false) : false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取静音状态\r\n     */\r\n    public get isMut() {\r\n        return this.mute;\r\n    }\r\n\r\n    /**\r\n     * 设置静音状态\r\n     */\r\n    public setMut() {\r\n        this.mute = !this.mute;\r\n\r\n        // 设置本地开关变量\r\n        if (window.localStorage) {\r\n            let value = (this.mute ? 'yes' : 'no');\r\n            window.localStorage.setItem('number_sprite_isMut', value)\r\n        }\r\n        // setMut(isMut);\r\n        this.setBgm();\r\n    }\r\n\r\n    public set crazy(flag: boolean) {\r\n        if (this.isCrazy != flag) {\r\n            this.isCrazy = flag;\r\n            this.setBgm();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置背景音效\r\n     */\r\n    public setBgm() {\r\n        //微信环境下\r\n        if (typeof wx != \"undefined\") {\r\n            this.setBgmWx();\r\n            return;\r\n        }\r\n\r\n        if (!this.mute) {\r\n            if (this.isCrazy) {\r\n                cc.audioEngine.stopEffect(this.bgmId);\r\n                this.crazyBgmId = cc.audioEngine.playEffect(this.clipArr[23], true);\r\n                cc.audioEngine.setVolume(this.crazyBgmId, effectVolume[23]);\r\n            }\r\n            else {\r\n                cc.audioEngine.stopEffect(this.crazyBgmId);\r\n                this.bgmId = cc.audioEngine.playEffect(this.clipArr[0], true);\r\n                cc.audioEngine.setVolume(this.bgmId, effectVolume[0]);\r\n            }\r\n        } else {\r\n            cc.audioEngine.stopEffect(this.crazyBgmId);\r\n            cc.audioEngine.stopEffect(this.bgmId);\r\n        }\r\n    }\r\n\r\n    private setBgmWx() {\r\n        if (!this.mute) {\r\n            if (this.isCrazy) {\r\n                this.audioArr[AudioType.CrazyFiveBgm].play();\r\n                this.audioArr[AudioType.GameBgm].pause();\r\n            } else {\r\n                this.audioArr[AudioType.CrazyFiveBgm].pause();\r\n                this.audioArr[AudioType.GameBgm].play();\r\n            }\r\n        } else {\r\n            this.audioArr[AudioType.GameBgm].pause();\r\n            this.audioArr[AudioType.CrazyFiveBgm].pause();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置疯狂背景音效\r\n     * @param active 是否是疯狂背景\r\n     */\r\n    public setCrazyBgm(active: boolean) {\r\n        this.isCrazy = active;\r\n        this.setBgm();\r\n    }\r\n\r\n    /**\r\n     * 播放音效\r\n     * @param clip 音效\r\n     * @param delay 延迟\r\n     */\r\n    public playAudio(clip: AudioType, delay: number = 0) {\r\n        if (this.mute)\r\n            return;\r\n        let callback = () => {\r\n            //连击为10\r\n            if (clip == 2)\r\n                clip = this.tenArr.random();\r\n            //微信环境下\r\n            if (typeof wx != \"undefined\") {\r\n                this.audioArr[clip].play();\r\n                return;\r\n            }\r\n\r\n            let volume = effectVolume[clip];\r\n            let id = cc.audioEngine.playEffect(this.clipArr[clip], false);\r\n            cc.audioEngine.setVolume(id, volume);\r\n        }\r\n\r\n        this.scheduleOnce(callback, delay);\r\n    }\r\n}"]}