{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\controller/assets\\scripts\\controller\\FinishCtrl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["// Copyright (C) 2019, Flickering Inc. All rights reserved.\r\n// Author: hongchangfu (hongchangfu@flickering.ai)\r\n\r\n//结束页面\r\n\r\nimport FinishView from \"../view/FinishView\";\r\nimport GameCtrl from \"./GameCtrl\";\r\nimport MySound, { AudioType } from \"../MySound\";\r\nimport RootNode, { postMessageName } from \"../RootNode\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst enum Type {\r\n    normal = 888,\r\n    week = 750,\r\n    best = 650\r\n}\r\n\r\n@ccclass\r\nexport default class FinishCtrl extends FinishView {\r\n    start() {\r\n        this.addEventListener();\r\n    }\r\n\r\n    /**\r\n     * 控制面板打开\r\n     * @param active 是否打开\r\n     */\r\n    public open(active: boolean) {\r\n        let instance = GameCtrl.instance;\r\n        if (!active) {\r\n            RootNode.instance.postMessage(postMessageName.finishBack, undefined);\r\n            instance.maskPanl.active = false;\r\n            this.node.active = false;\r\n            return;\r\n        }\r\n        this.node.active = true;\r\n        let data = RootNode.instance.userDate;\r\n        data.curscore = instance.Score;\r\n        this.setSize();\r\n        RootNode.instance.postMessage(postMessageName.finish, data);\r\n        this.node.runAction(cc.fadeIn(0.3));\r\n        RootNode.instance.fadeIn(0.3);\r\n        RootNode.instance.updateScore(instance.Score);\r\n        RootNode.instance.gameLog.recordAction(\"finish\");\r\n        RootNode.instance.gameLog.sendAction();\r\n    }\r\n\r\n    /**\r\n     * 监听重玩,返回首页按键\r\n     */\r\n    private addEventListener() {\r\n        this.replayBtn.on(\"click\", () => {\r\n            MySound.instance.playAudio(AudioType.Button);\r\n            GameCtrl.instance.replay();\r\n            //重玩开始记录游戏操作\r\n            RootNode.instance.gameLog.startRecorder();\r\n        });\r\n\r\n        this.homeBtn.on(\"click\", () => {\r\n            MySound.instance.playAudio(AudioType.Button);\r\n            RootNode.instance.postMessage(postMessageName.finishBack, undefined);\r\n            RootNode.instance.loadScene(\"home\");\r\n        })\r\n\r\n        this.shareBtn.on(\"click\", () => {\r\n            MySound.instance.playAudio(AudioType.Button);\r\n            RootNode.instance.onShareBtn(1);\r\n        })\r\n\r\n        this.chartsBtn.on(\"click\", () => {\r\n            MySound.instance.playAudio(AudioType.Button);\r\n            GameCtrl.instance.charts.open();\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 设置面板高度\r\n     */\r\n    private setSize() {\r\n        let data = RootNode.instance.userDate;\r\n        \r\n        //网络异常\r\n        if(data.weeknum == -1)\r\n        {\r\n            this.node.height = Type.best;\r\n            return;\r\n        }\r\n        let height = Type.normal\r\n        if (data.curscore > data.maxscore) {\r\n            height = Type.best;\r\n        } else if (data.curscore > data.maxweekscore) {\r\n            height = Type.week;\r\n        }\r\n        this.node.height = height;\r\n    }\r\n}"]}