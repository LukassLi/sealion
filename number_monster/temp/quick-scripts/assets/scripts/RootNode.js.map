{"version":3,"sources":["RootNode.ts"],"names":[],"mappings":";;;;AAAA,2DAA2D;AAC3D,kDAAkD;;AAElD,WAAW;AAEX,qCAAgC;AAEhC,qCAAgC;AAG1B,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAI5C,WAAW;AACE,QAAA,eAAe,GAAG;IAC3B,MAAM,EAAE,QAAQ;IAChB,MAAM,EAAE,QAAQ;IAChB,KAAK,EAAE,OAAO;IACd,MAAM,EAAE,QAAQ;IAChB,UAAU,EAAE,YAAY;IACxB,UAAU,EAAE,YAAY;IACxB,UAAU,EAAE,YAAY;IACxB,OAAO,EAAE,SAAS;IAClB,WAAW,EAAE,aAAa;IAC1B,WAAW,EAAE,aAAa;CAC7B,CAAA;AAED,cAAc;AACD,QAAA,UAAU,GAAG;IACtB,KAAK,EAAE,aAAa;IACpB,MAAM,EAAE,cAAc;IACtB,MAAM,EAAE,cAAc;IACtB,SAAS,EAAE,uBAAuB;IAClC,KAAK,EAAE,WAAW;CACrB,CAAA;AAUD;IAAsC,4BAAY;IADlD;QAAA,qEAqzBC;QA9yBG,WAAW;QACJ,cAAQ,GAAS;YACpB,QAAQ,EAAE,CAAC;YACX,QAAQ,EAAE,CAAC;YACX,YAAY,EAAE,CAAC;YACf,OAAO,EAAE,CAAC,CAAC;SACd,CAAC;QAEF,YAAY;QACL,eAAS,GAAQ,SAAS,CAAC;QAElC,SAAS;QACF,aAAO,GAAY,SAAS,CAAC;QAKpC,WAAW;QACH,aAAO,GAAQ,SAAS,CAAC;QAEjC,cAAc;QACN,eAAS,GAAwB,SAAS,CAAC;QAEnD,YAAY;QACJ,cAAQ,GAAW,CAAC,CAAC;QAE7B,aAAa;QACL,iBAAW,GAAW,CAAC,CAAC;QAEhC,aAAa;QACL,YAAM,GAAY,KAAK,CAAC;QAEhC,oBAAoB;QACZ,gBAAU,GAAG,KAAK,CAAC;QAE3B,eAAe;QACP,aAAO,GAAY,KAAK,CAAC;QAEjC,aAAa;QACN,eAAS,GAAY,IAAI,CAAC;QAEjC,WAAW;QACH,iBAAW,GAAG;YAClB,yBAAyB;YACzB,qBAAqB;YACrB,2BAA2B;SAC9B,CAAC;QAEF,YAAY;QACJ,iBAAW,GAAG;YAClB,gCAAgC;YAChC,kBAAkB;SACrB,CAAC;QAEF,cAAc;QACN,cAAQ,GAAG;YACf,2GAA2G;YAC3G,2GAA2G;SAC9G,CAAA;QAGD,aAAa;QACL,gBAAU,GACd;YACI,wBAAwB;YACxB,wBAAwB;SAC3B,CAAC;QAEN,gBAAgB;QACR,aAAO,GAAG,8CAA8C,CAAC;;IAyuBrE,CAAC;iBApzBoB,QAAQ;IA6EnB,yBAAM,GAAZ;;;gBACI,UAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACzB,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACtC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,gBAAgB,CAAC,CAAC;gBAC7D,IAAI,CAAC,SAAS,CAAC,OAAO,GAAG,KAAK,CAAC;gBAC/B,IAAI,CAAC,OAAO,EAAE,CAAC;gBACf,IAAI,CAAC,aAAa,EAAE,CAAC;gBACrB,IAAI,CAAC,UAAU,EAAE,CAAC;gBAClB,IAAI,CAAC,OAAO,EAAE,CAAC;gBACf,IAAI,CAAC,OAAO,GAAG,IAAI,iBAAO,EAAE,CAAC;gBAC7B,UAAQ,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC;;;;KACjC;IAED,wBAAK,GAAL;QACI,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,CAAC;IAED,QAAQ;IACA,6BAAU,GAAlB;QAAA,iBAwDC;QAvDG,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QAED,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,eAAe;QACf,EAAE,CAAC,MAAM,CAAC,UAAC,GAAG;YACV,IAAI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC;YAC3B,IAAI,MAAM,GAAG,GAAG,CAAC,WAAW,CAAC;YAC7B,IAAI,KAAK,IAAI,OAAO,IAAI,KAAI,CAAC,SAAS,IAAI,SAAS,IAAI,MAAM,IAAI,SAAS,EAAE;gBACxE,KAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;aAC1B;YAED,IAAI,GAAG,CAAC,KAAK,CAAC,OAAO,IAAI,OAAO,IAAI,CAAC,KAAI,CAAC,KAAK,EAAE;gBAC7C,KAAI,CAAC,KAAK,GAAG,IAAI,CAAC;gBAClB,KAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;aAC1B;QACL,CAAC,CAAC,CAAA;QAEF,QAAQ;QACR,EAAE,CAAC,eAAe,CAAC,UAAC,GAAG;YACnB,KAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,MAAM;QACN,EAAE,CAAC,OAAO,CAAC,UAAC,GAAG;YACX,KAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;QACnD,CAAC,CAAC,CAAA;QAEF,UAAU;QACV,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE;YAC3B,cAAc;YACd,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;YACrC,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;YAC1B,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QACpB,CAAC,EAAE,IAAI,CAAC,CAAC;QAET,UAAU;QACV,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE;YAC3B,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YACjB,IAAI,iBAAO,CAAC,QAAQ,EAAE;gBAClB,iBAAO,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;aAC7B;QACL,CAAC,EAAE,IAAI,CAAC,CAAC;QAET,EAAE,CAAC,wBAAwB,CAAC;YACxB,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QACpB,CAAC,CAAC,CAAA;QAEF,EAAE,CAAC,sBAAsB,CAAC;YAC1B,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YACb,IAAI,iBAAO,CAAC,QAAQ,EAAE;gBAClB,iBAAO,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;aAC7B;QACL,CAAC,CAAC,CAAA;IACN,CAAC;IAED;;OAEG;IACI,4BAAS,GAAhB;QACI,IAAI,OAAO,EAAE,IAAI,WAAW;YACxB,EAAE,CAAC,SAAS,EAAE,CAAC;IACvB,CAAC;IAED;;OAEG;IACI,8BAAW,GAAlB;QACI,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;QAC7B,GAAG,CAAC,CAAC,IAAI,UAAQ,CAAC,SAAS,CAAC;QAC5B,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC;IAC7B,CAAC;IAED;;;OAGG;IACI,yBAAM,GAAb,UAAc,IAAY;QACtB,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;IACzC,CAAC;IAED;;;OAGG;IACI,kCAAe,GAAtB,UAAuB,IAAY;QAC/B,IAAI,KAAK,GAAG,SAAS,CAAC;QACtB,IAAI,MAAM,CAAC,YAAY,EAAE;YACrB,KAAK,GAAG,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;SAC7C;QACD,OAAO,KAAK,CAAC;IACjB,CAAC;IAED;;;;OAIG;IACI,kCAAe,GAAtB,UAAuB,IAAY,EAAE,KAAa;QAC9C,IAAI,MAAM,CAAC,YAAY,EAAE;YACrB,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;SAC3C;IACL,CAAC;IAED,kBAAkB;IACX,6BAAU,GAAjB;QACI,cAAc;QACd,IAAI,IAAI,CAAC,OAAO;YACZ,OAAO;QACX,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,MAAM,GAAG,UAAQ,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAA;QAClD,6BAA6B;QAC7B,IAAI,MAAM,IAAI,IAAI,CAAC,SAAS,IAAI,SAAS;YACrC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAC/B,CAAC;IAKD,sBAAW,iCAAW;QAHtB;;WAEG;aACH;YACI,wBAAwB;YACxB,IAAI,IAAI,CAAC,MAAM,IAAI,SAAS,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,IAAI,CAAC,CAAC;gBACvD,OAAO,IAAI,CAAC;YAChB,OAAO,KAAK,CAAC;QACjB,CAAC;;;OAAA;IAED;;;OAGG;IACI,8BAAW,GAAlB,UAAmB,KAAa;QAC5B,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QACD,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,EAAE,CAAC,SAAS,CAAC;YACT,KAAK,EAAE,IAAI;YACX,OAAO,EAAE,aAAa;YACtB,UAAU,EAAE,IAAI;YAChB,WAAW,EAAE,IAAI;YACjB,YAAY,EAAE,SAAS;YACvB,OAAO,YAAC,GAAG;gBACP,IAAI,GAAG,CAAC,OAAO,EAAE;oBACb,IAAI,CAAC,SAAS,EAAE,CAAC;oBACjB,KAAK,CAAC,WAAW,EAAE,CAAC;iBACvB;qBAAM,IAAI,GAAG,CAAC,MAAM,EAAE;iBAEtB;YACL,CAAC;SACJ,CAAC,CAAA;IACN,CAAC;IAED;;;OAGG;IACI,8BAAW,GAAlB,UAAmB,KAAa;QAAhC,iBA4DC;QA3DG,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;gBAC1B,IAAI,QAAQ,GAAS;oBACjB,QAAQ,EAAE,KAAK;oBACf,QAAQ,EAAE,KAAK;oBACf,YAAY,EAAE,KAAK;oBACnB,OAAO,EAAE,CAAC,CAAC;iBACd,CAAA;gBACD,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;gBACzB,OAAO,CAAC,IAAI,CAAC,CAAC;aACjB;YAED,IAAI,KAAI,CAAC,MAAM,IAAI,EAAE,EAAE;gBACnB,OAAO,CAAC,KAAK,CAAC,CAAC;gBACf,OAAO;aACV;YAGD,EAAE,CAAC,OAAO,CAAC;gBACP,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC;gBAChC,IAAI,EAAE;oBACF,QAAQ,EAAE,IAAI,CAAC,MAAM;oBACrB,OAAO,EAAE,KAAK;oBACd,SAAS,EAAE,IAAI,CAAC,QAAQ;oBACxB,cAAc,EAAE,IAAI,CAAC,WAAW;iBACnC;gBACD,MAAM,EAAE,MAAM;gBACd,OAAO,YAAC,GAAG;oBACP,OAAO,CAAC,IAAI,CAAC,CAAC;oBACd,IAAI,GAAG,CAAC,IAAI,EAAE;wBACV,MAAM;wBACN,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI;4BACtB,OAAO;wBACX,IAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC;wBACzB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;wBACrB,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI,SAAS;4BAC7B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBACjC,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,IAAI,SAAS;4BAClC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;wBAC5C,mBAAmB;wBACnB,IAAI,KAAK,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,IAAI,CAAC,EAAE;4BACxC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;4BACf,IAAI,CAAC,WAAW,CAAC,uBAAe,CAAC,WAAW,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;yBAChE;qBACJ;oBACD,OAAO,CAAC,IAAI,CAAC,CAAA;gBACjB,CAAC;gBACD,IAAI,YAAC,GAAG;oBACJ,IAAI;oBACJ,IAAI,UAAQ,CAAC,YAAY,IAAI,MAAM;wBAC/B,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;yBAChC,WAAW;wBACX,IAAI,CAAC,uBAAuB,EAAE,CAAC;oBACnC,OAAO,CAAC,KAAK,CAAC,CAAA;oBACd,IAAI;gBACR,CAAC;aACJ,CAAC,CAAA;QACN,CAAC,CAAC,CAAA;IACN,CAAC;IAED;;;;OAIG;IACI,8BAAW,GAAlB,UAAmB,OAAe,EAAE,QAAa;QAC7C,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QAED,sCAAsC;QACtC,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YACvC,IAAI,CAAC,SAAS,EAAE,CAAC;SACpB;QAED,IAAI,eAAe,GAAG,EAAE,CAAC,kBAAkB,EAAE,CAAC;QAC9C,eAAe,CAAC,WAAW,CAAC;YACxB,IAAI,EAAE,OAAO;YACb,KAAK,EAAE,QAAQ;SAClB,CAAC,CAAA;QACF,IAAI,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;IAC3C,CAAC;IAED;;;OAGG;IACI,4BAAS,GAAhB,UAAiB,KAAa;QAC1B,UAAQ,CAAC,YAAY,GAAG,KAAK,CAAC;QAC9B,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QAC7B,IAAI,iBAAO,CAAC,QAAQ,IAAI,SAAS;YAC7B,iBAAO,CAAC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC;IACvC,CAAC;IAED;;OAEG;IACI,6BAAU,GAAjB,UAAkB,GAAe;QAAf,oBAAA,EAAA,OAAe;QAC7B,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QAED,EAAE,CAAC,kBAAkB,CAAC;YAClB,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;YAChC,UAAU,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC;YAChC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC;SAC/B,CAAC,CAAA;IACN,CAAC;IAED;;OAEG;IACI,wCAAqB,GAA5B;QACI,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QACD,EAAE,CAAC,kBAAkB,CAAC;YAClB,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;YAChC,UAAU,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YAC9B,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC1B,KAAK,EAAE,YAAY;SACtB,CAAC,CAAA;IACN,CAAC;IAAA,CAAC;IAEF;;OAEG;IACI,oCAAiB,GAAxB;QACI,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QACD,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,GAAG,GAAG,EAAE,CAAC,oBAAoB,EAAE,CAAC;QACpC,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACtC,IAAI,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;QACpD,IAAI,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC;QAClC,EAAE,CAAC,aAAa,CAAC;YACb,OAAO,YAAC,IAAI;gBACR,MAAM;gBACN,IAAI,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;gBACtC,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,CAAC;YAC5F,CAAC;SACJ,CAAC,CAAA;QACF,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,IAAI,OAAO;YACzB,OAAO,SAAS,CAAC;QACrB,OAAO,GAAG,CAAC,WAAW,CAAC;IAC3B,CAAC;IAKD,sBAAW,4BAAM;QAHjB;;UAEE;aACF;YACI,OAAO,IAAI,CAAC,eAAe,CAAC,kBAAU,CAAC,MAAM,CAAC,CAAC;QACnD,CAAC;;;OAAA;IAKD,sBAAW,6BAAO;QAHlB;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,QAAQ,CAAC;QACzB,CAAC;;;OAAA;IAKD,sBAAW,gCAAU;QAHrB;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,WAAW,CAAC;QAC5B,CAAC;;;OAAA;IAKD,sBAAW,2BAAK;QAHhB;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,MAAM,CAAC;QACvB,CAAC;QAED;;UAEE;aACF,UAAiB,IAAa;YAC1B,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,EAAE;gBACrB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;gBACnB,IAAI,CAAC,cAAc,EAAE,CAAC;gBACtB,IAAI,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;gBAChC,IAAI,CAAC,eAAe,CAAC,kBAAU,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;aACjD;QACL,CAAC;;;OAZA;IAcD;;OAEG;IACI,0BAAO,GAAd;QACI,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QAED,EAAE,CAAC,qBAAqB,CAAC;YACrB,KAAK,EAAE,oBAAoB;SAC9B,CAAC,CAAA;IACN,CAAC;IAKD,sBAAW,+BAAS;QAHpB;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,eAAe,CAAC,kBAAU,CAAC,SAAS,CAAC,IAAI,IAAI,CAAC;QAC9D,CAAC;;;OAAA;IAED;;OAEG;IACI,+BAAY,GAAnB;QACI,IAAI,CAAC,eAAe,CAAC,kBAAU,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IACrD,CAAC;IAED;;OAEG;IACI,2BAAQ,GAAf;QACI,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAC3B,CAAC;IAED;;OAEG;IACI,kCAAe,GAAtB;QACI,OAAO,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC;IACpC,CAAC;IAED;;OAEG;IACI,gCAAa,GAApB;QACI,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;IAClC,CAAC;IAED;;MAEE;IACK,iCAAc,GAArB;QACI,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC;IACnC,CAAC;IAED;;MAEE;IACK,8BAAW,GAAlB;QACI,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;IAChC,CAAC;IAKD,sBAAY,4BAAM;QAHlB;;WAEG;aACH;YACI,IAAI,IAAI,CAAC,OAAO,IAAI,SAAS;gBACzB,IAAI,CAAC,cAAc,EAAE,CAAC;YAC1B,OAAO,IAAI,CAAC,OAAO,CAAC;QACxB,CAAC;;;OAAA;IAED;;OAEG;IACU,0CAAuB,GAApC;;;;gBACI,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;oBAC1B,sBAAO;iBACV;gBACD,IAAI,IAAI,CAAC,KAAK,IAAI,CAAC;oBACf,sBAAO;gBACP,IAAI,GAAG,IAAI,CAAC;gBAChB,EAAE,CAAC,SAAS,CAAC;oBACT,KAAK,EAAE,IAAI;oBACX,OAAO,EAAE,iBAAiB;oBAC1B,UAAU,EAAE,IAAI;oBAChB,WAAW,EAAE,IAAI;oBACjB,YAAY,EAAE,SAAS;oBACvB,OAAO,YAAC,GAAG;wBACP,IAAI,GAAG,CAAC,OAAO,EAAE;4BACb,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;yBAChC;6BAAM,IAAI,GAAG,CAAC,MAAM,EAAE;4BACnB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;yBAClB;oBACL,CAAC;iBACJ,CAAC,CAAA;;;;KACL;IAED;;OAEG;IACK,0BAAO,GAAf;QACI,IAAI,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,kBAAU,CAAC,KAAK,CAAC,CAAC;QACnD,IAAI,CAAC,MAAM,GAAG,KAAK,IAAI,KAAK,CAAC;IACjC,CAAC;IAED;;MAEE;IACM,6BAAU,GAAlB;QACI,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QACD,IAAI,GAAG,GAAG,EAAE,CAAC,oBAAoB,EAAE,CAAC;QACpC,IAAI,GAAG,CAAC,KAAK,CAAC,OAAO,IAAI,OAAO;YAC5B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IAC1B,CAAC;IAED;;MAEE;IACM,sCAAmB,GAA3B,UAA4B,KAAa;QACrC,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QAED,IAAI,IAAI,GAAG,IAAI,CAAC;QAEhB,0BAA0B;QAC1B,IAAI,IAAI,CAAC,KAAK,GAAG,KAAK,IAAI,KAAK,IAAI,CAAC;YAChC,OAAO;QACX,EAAE,CAAC,SAAS,CAAC;YACT,KAAK,EAAE,IAAI;YACX,OAAO,EAAE,kBAAkB;YAC3B,UAAU,EAAE,MAAM;YAClB,WAAW,EAAE,IAAI;YACjB,YAAY,EAAE,SAAS;YACvB,OAAO,YAAC,GAAG;gBACP,IAAI,GAAG,CAAC,OAAO,EAAE;oBACb,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;iBAC3B;qBAAM,IAAI,GAAG,CAAC,MAAM,EAAE;oBACnB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;iBACtB;YACL,CAAC;SACJ,CAAC,CAAA;IACN,CAAC;IAED;;MAEE;IACY,4BAAS,GAAvB;;;;;;wBACI,IAAI,CAAC,UAAU,EAAE,CAAC;wBAElB,qBAAM,IAAI,CAAC,KAAK,EAAE,EAAA;;wBAAlB,SAAkB,CAAC;wBACnB,qBAAM,UAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC,EAAA;;wBAAtC,SAAsC,CAAC;wBAEvC,cAAc;wBACd,IAAI,IAAI,CAAC,WAAW,EAAE;4BACd,KAAK,GAAQ,EAAE,CAAA;4BACnB,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;4BAC3B,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;4BACtC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;4BACvB,IAAI,CAAC,WAAW,CAAC,uBAAe,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;yBACnD;;;;;KACJ;IAKD,sBAAY,2BAAK;QAHjB;;WAEG;aACH;YACI,IAAI,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,kBAAU,CAAC,KAAK,CAAC,CAAA;YAClD,IAAI,KAAK,IAAI,SAAS,IAAI,KAAK,IAAI,EAAE;gBACjC,OAAO,CAAC,CAAC;YACb,OAAO,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC3B,CAAC;QAED;;WAEG;aACH,UAAkB,GAAW;YACzB,IAAI,CAAC,eAAe,CAAC,kBAAU,CAAC,KAAK,EAAE,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC3D,CAAC;;;OAPA;IASD;;OAEG;IACK,gCAAa,GAArB;QACI,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QACD,UAAU;QACV,EAAE,CAAC,aAAa,EAAE,CAAC;QAEnB,SAAS;QACT,EAAE,CAAC,eAAe,CAAC;YACf,eAAe,EAAE,IAAI;SACxB,CAAC,CAAA;QAEF,IAAI,IAAI,GAAG,IAAI,CAAC;QAEhB,EAAE,CAAC,oBAAoB,CAAC,UAAU,GAAG;YACjC,OAAO;gBACH,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;gBAChC,UAAU,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;gBAC9B,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;aAC7B,CAAA;QACL,CAAC,CAAC,CAAA;IAGN,CAAC;IAED;;KAEC;IACO,wBAAK,GAAb;QACI,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,OAAO;SACV;QACD,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,EAAE,CAAC,KAAK,CAAC;gBACL,OAAO,YAAC,GAAG;oBACP,IAAI,GAAG,CAAC,IAAI,EAAE;wBACV,SAAS;wBACT,EAAE,CAAC,OAAO,CAAC;4BACP,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;4BAC5B,IAAI,EAAE;gCACF,IAAI,EAAE,GAAG,CAAC,IAAI;6BACjB;4BACD,MAAM,EAAE,MAAM;4BACd,OAAO,YAAC,GAAG;gCACP,IAAI,GAAG,CAAC,IAAI,EAAE;oCACV,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oCAE9B,oBAAoB;oCACpB,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI;wCACtB,OAAO;oCACX,IAAI,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;oCAClC,IAAI,CAAC,eAAe,CAAC,kBAAU,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;iCACnD;qCAAM;oCACH,OAAO,CAAC,gBAAgB,CAAC,CAAC;iCAC7B;4BAEL,CAAC;4BACD,IAAI;gCACA,OAAO,CAAC,YAAY,CAAC,CAAC;4BAC1B,CAAC;yBACJ,CAAC,CAAC;qBACN;yBAAM;wBACH,OAAO,CAAC,UAAU,CAAC,CAAC;qBACvB;gBACL,CAAC;gBACD,IAAI;oBACA,OAAO,CAAC,QAAQ,CAAC,CAAA;gBACrB,CAAC;aACJ,CAAC,CAAA;QACN,CAAC,CAAC,CAAA;IACN,CAAC;IAGD;;MAEE;IACM,0BAAO,GAAf;QACI,IAAI,OAAO,EAAE,IAAI,WAAW,EAAE;YAC1B,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,OAAO;SACV;QACD,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,SAAS;QACT,EAAE,CAAC,OAAO,CAAC;YACP,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC;YAC9B,MAAM,EAAE,MAAM;YACd,OAAO,YAAC,GAAG;gBACP,IAAI,GAAG,CAAC,IAAI,EAAE;oBACV,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;iBAC7C;YACL,CAAC;YACD,QAAQ;gBACJ,IAAI,CAAC,cAAc,EAAE,CAAC;YAC1B,CAAC;SACJ,CAAC,CAAC;IACP,CAAC;IAED;;;OAGG;IACW,2CAAwB,GAAtC,UAAuC,OAAe;;;;gBAClD,WAAW;gBACX,IAAI,CAAC,sBAAsB,EAAE,CAAC;gBAC9B,KAAK;gBACL,IAAI,OAAO,IAAI,uBAAe,CAAC,MAAM,IAAI,OAAO,IAAI,uBAAe,CAAC,KAAK,EAAE;oBACvE,IAAI,CAAC,SAAS,CAAC,OAAO,GAAG,IAAI,CAAC;iBACjC;qBACI,IAAI,OAAO,IAAI,uBAAe,CAAC,MAAM,IAAI,OAAO,IAAI,uBAAe,CAAC,WAAW,EAAE,0BAA0B;iBAChH;oBACI,IAAI,CAAC,SAAS,CAAC,OAAO,GAAG,IAAI,CAAC;oBAC9B,IAAI,CAAC,YAAY,CAAC;wBACd,KAAI,CAAC,SAAS,CAAC,OAAO,GAAG,KAAK,CAAC;oBACnC,CAAC,EAAE,CAAC,CAAC,CAAC;iBACT;;;;KACJ;IAED;;OAEG;IACK,iCAAc,GAAtB;QACI,QAAQ;QACR,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC;QAC9C,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC;QACxC,GAAG,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,kBAAU,CAAC,MAAM,CAAC;QACjD,IAAI,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;QACtC,IAAI,KAAK,IAAI,EAAE,IAAI,KAAK,IAAI,SAAS,EAAE;YACnC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC7B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC;SAC5B;aAAM;YACH,IAAI,MAAI,GAAG,IAAI,CAAC;YAChB,IAAI,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,iBAAiB,CAAC;YAC1E,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,EAAE,UAAU,GAAG,EAAE,MAAM;gBAC/C,IAAI,GAAG,EAAE;oBACL,OAAO;iBACV;gBACD,IAAI,OAAO,GAAG,MAAI,CAAC,KAAK,CAAC,CAAC,CAAC,MAAI,CAAC,WAAW,CAAC,CAAC,CAAC,MAAI,CAAC,QAAQ,CAAC;gBAC5D,IAAI,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO;oBAC7B,OAAO;gBACX,MAAI,CAAC,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;YACpC,CAAC,CAAC,CAAC;SACN;IACL,CAAC;IAED;;MAEE;IACM,8BAAW,GAAnB;QACI,IAAI,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC;QAClD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;YACxB,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC;YACpC,IAAI,GAAG,GAAG,IAAI,GAAG,GAAG,GAAG,OAAO,GAAG,GAAG,GAAG,kBAAU,CAAC,MAAM,CAAC;YACzD,IAAI,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;YACtC,IAAI,KAAK,IAAI,EAAE,IAAI,KAAK,IAAI,SAAS,EAAE;gBACnC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBAC7B,IAAI,CAAC,IAAI,CAAC;oBACN,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;;oBAExC,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aAC5C;SACJ;IACL,CAAC;IAED;;;;OAIG;IACK,6BAAU,GAAlB,UAAmB,IAAS,EAAE,GAAoB;QAApB,oBAAA,EAAA,WAAoB;QAC9C,IAAI,GAAG;YACH,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC;;YAEhC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC;QAEjC,IAAI,IAAI,CAAC,KAAK,IAAI,GAAG;YACjB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC;QAC7B,IAAI,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC;QAC9C,IAAI,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC;QACjC,GAAG,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,kBAAU,CAAC,MAAM,CAAC;QACjD,IAAI,CAAC,eAAe,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;IACpD,CAAC;IAED;;;OAGG;IACK,yBAAM,GAAd,UAAe,GAAW;QACtB,OAAO,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;IAC9B,CAAC;;IAlzBa,iBAAQ,GAAa,SAAS,CAAC;IAE7C,cAAc;IACA,qBAAY,GAAW,EAAE,CAAC;IAgBxC,cAAc;IACA,kBAAS,GAAW,CAAC,CAAC;IArBnB,QAAQ;QAD5B,OAAO;OACa,QAAQ,CAozB5B;IAAD,eAAC;CApzBD,AAozBC,CApzBqC,EAAE,CAAC,SAAS,GAozBjD;kBApzBoB,QAAQ","file":"","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Copyright (C) 2019, Flickering Inc. All rights reserved.\r\n// Author: hongchangfu (hongchangfu@flickering.ai)\r\n\r\n//永驻节点处理微信域\r\n\r\nimport GameLog from \"./GameLog\";\r\nimport Charts from \"./controller/Charts\";\r\nimport MySound from \"./MySound\";\r\nimport ald = require(\"./utils/ald-game\");\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\ndeclare const wx: any;\r\n\r\n/** 消息名称 */\r\nexport const postMessageName = {\r\n    finish: \"finish\",            //游戏结束结算\r\n    charts: \"charts\",            //排行榜\r\n    group: \"group\",             //群排行\r\n    openId: \"openid\",            //向子域传递自己的openID\r\n    chartsBack: \"chartsBack\",    //排行榜关闭\r\n    finishBack: \"finishBack\",    //结束界面关闭\r\n    finishHide: \"finishHide\",    //结束界面隐藏\r\n    revival: \"revival\",            //复活界面\r\n    revivalBack: \"revivalBack\",    //复活界面关闭\r\n    updateScore: \"updateScore\",    // 新分数更新数据\r\n}\r\n\r\n/** 保存本地key */\r\nexport const storageKey = {\r\n    score: \"local_score\",               //存储上传失败的分数\r\n    config: \"local_config\",             //存储配置信息        \r\n    openid: \"local_openid\",             //游戏的openid\r\n    firstOpen: \"local_first_open_game\",  //第一次进入游戏,新手引导\r\n    isKid: \"local_Kid\",                  //是否为儿童版\r\n}\r\n\r\ninterface data {\r\n    curscore: number\t\t//当前分数\r\n    maxscore: number        //历史最高（本次分数之前的历史最高）\r\n    maxweekscore: number    //周最高 （本次分数之前的周最高）\r\n    weeknum: number         //第几周\r\n}\r\n\r\n@ccclass\r\nexport default class RootNode extends cc.Component {\r\n    public static instance: RootNode = undefined;\r\n\r\n    /** 当前scene */\r\n    public static currentScene: string = \"\";\r\n\r\n    /** 用户数据 */\r\n    public userDate: data = {\r\n        curscore: 0,\r\n        maxscore: 0,\r\n        maxweekscore: 0,\r\n        weeknum: -1,\r\n    };\r\n\r\n    /** 显示群排行 */\r\n    public showGroup: any = undefined;\r\n\r\n    /** 日志 */\r\n    public gameLog: GameLog = undefined;\r\n\r\n    /** 刘海屏适配位置 */\r\n    public static fixHeight: number = 0;\r\n\r\n    /** 游戏配置 */\r\n    private _config: any = undefined;\r\n\r\n    /** 展示微信域组件 */\r\n    private wxSubView: cc.WXSubContextView = undefined;\r\n\r\n    /** 配置版本号 */\r\n    private _version: number = 0;\r\n\r\n    /** 儿童版配置号 */\r\n    private _kidversion: number = 0;\r\n\r\n    /** 是否是儿童版 */\r\n    private _isKid: boolean = false;\r\n\r\n    /** 是否给子域发送过初始化信息 */\r\n    private isSentInit = false;\r\n\r\n    /** 是否是第一次登入 */\r\n    private islunch: boolean = false;\r\n\r\n    /** 是否为正式版 */\r\n    public isRelease: boolean = true;\r\n\r\n    /** 分享文案 */\r\n    private shareString = [\r\n        '会一加一就能玩，全国只有1%能上20000分！',\r\n        '从小被数学虐? 这回给你机会打败学霸!',\r\n        '凑十加法过不了10000分? 幼儿园的娃都比你强!'\r\n    ];\r\n\r\n    /** 群分享文案 */\r\n    private groupString = [\r\n        '听说这个群里个个都是人才敢不敢和我来一场高手之间的脑力对决！',\r\n        '我向你发起挑战，你小学毕业了吗？'\r\n    ];\r\n\r\n    /** 分享图片url */\r\n    private imageUrl = [\r\n        \"https://mmocgame.qpic.cn/wechatgame/3opnTXQiccus22cBo75MYk0D7HXDAnzeV7ns2XnibZAc64fhZib6fBC9WKJ6SoTOkYq/0\",\r\n        \"https://mmocgame.qpic.cn/wechatgame/3opnTXQiccusjMUIOiaEw6RS0JnmtzNfHsjUQJbLPFibvS30osmNJxYwPKr0nT1GW6V/0\",\r\n    ]\r\n\r\n\r\n    /** 分享图片id */\r\n    private imageUrlId =\r\n        [\r\n            \"wn4rHZIkTReQ9hYos9-oHQ\",\r\n            \"iJXKHNcuTOG9C3jtMZod0Q\"\r\n        ];\r\n\r\n    /** 上传url前半部分 */\r\n    private urlhead = \"https://log.mathufo.com/number_monster/v1.0/\";\r\n\r\n    async onLoad() {\r\n        RootNode.instance = this;\r\n        cc.game.addPersistRootNode(this.node);\r\n        this.wxSubView = this.node.getComponent(cc.WXSubContextView);\r\n        this.wxSubView.enabled = false;\r\n        this.initKid();\r\n        this.initShareMenu();\r\n        this.wxListener();\r\n        this.release();\r\n        this.gameLog = new GameLog();\r\n        RootNode.instance.initLogin();\r\n    }\r\n\r\n    start() {\r\n        this.fixPosition();\r\n    }\r\n\r\n    //微信事件监听\r\n    private wxListener() {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        let self = this;\r\n        //小游戏回到前台,用于群排行\r\n        wx.onShow((res) => {\r\n            let query = res.query.type;\r\n            let ticket = res.shareTicket;\r\n            if (query == \"group\" && this.showGroup != undefined && ticket != undefined) {\r\n                this.showGroup(ticket);\r\n            }\r\n\r\n            if (res.query.version == \"child\" && !this.isKid) {\r\n                this.isKid = true;\r\n                this.loadScene(\"load\");\r\n            }\r\n        })\r\n\r\n        //监听内存不足\r\n        wx.onMemoryWarning((res) => {\r\n            this.gameLog.sendMemoryWarning(res.level);\r\n        });\r\n\r\n        //监听错误\r\n        wx.onError((res) => {\r\n            this.gameLog.sendError(res.message, res.stack);\r\n        })\r\n\r\n        //退到后台暂停游戏\r\n        cc.game.on(cc.game.EVENT_HIDE, function () {\r\n            //退到后台时,发送操作日志\r\n            self.gameLog.recordAction(\"signOut\");\r\n            self.gameLog.sendAction();\r\n            cc.game.pause();\r\n        }, this);\r\n\r\n        //回到前台重启游戏\r\n        cc.game.on(cc.game.EVENT_SHOW, function () {\r\n            cc.game.resume();\r\n            if (MySound.instance) {\r\n                MySound.instance.setBgm();\r\n            }\r\n        }, this);\r\n\r\n        wx.onAudioInterruptionBegin(function () {\r\n            cc.game.pause();\r\n        })\r\n\r\n        wx.onAudioInterruptionEnd(() => {\r\n        cc.game.resume();\r\n            if (MySound.instance) {\r\n                MySound.instance.setBgm();\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 主动触发回收\r\n     */\r\n    public triggerGC() {\r\n        if (typeof wx != \"undefined\")\r\n            wx.triggerGC();\r\n    }\r\n\r\n    /**\r\n     * 刘海屏调整位置\r\n     */\r\n    public fixPosition() {\r\n        let pos = this.node.position;\r\n        pos.y -= RootNode.fixHeight;\r\n        this.node.position = pos;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param time 渐显时间\r\n     */\r\n    public fadeIn(time: number) {\r\n        this.node.active = true;\r\n        this.node.runAction(cc.fadeIn(time));\r\n    }\r\n\r\n    /**\r\n     * 获取本地数据\r\n     * @param name 保存数据名字\r\n     */\r\n    public getLocalStorage(name: string): string {\r\n        let value = undefined;\r\n        if (window.localStorage) {\r\n            value = window.localStorage.getItem(name);\r\n        }\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 保存本地数据\r\n     * @param name 保存数据名字\r\n     * @param value 保存的值\r\n     */\r\n    public setLocalStorage(name: string, value: string) {\r\n        if (window.localStorage) {\r\n            window.localStorage.setItem(name, value)\r\n        }\r\n    }\r\n\r\n    /** 启动时是否是拉起群排行 */\r\n    public LunchGroup() {\r\n        //拉起启动群排行只执行一次\r\n        if (this.islunch)\r\n            return;\r\n        this.islunch = true;\r\n        let ticket = RootNode.instance.isLunchGroupShare()\r\n        //进入信息包括群分享ticket,群分享展示否则更新数据\r\n        if (ticket && this.showGroup != undefined)\r\n            this.showGroup(ticket);\r\n    }\r\n\r\n    /**\r\n     * 初始化成功\r\n     */\r\n    public get initSuccess() {\r\n        //获取到openid 和 玩家信息为初始化成功\r\n        if (this.openId != undefined && this.userDate.weeknum != -1)\r\n            return true;\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 初始化超时.弹提示信息\r\n     * @param chart 排行榜面板\r\n     */\r\n    public InitTimeOut(chart: Charts) {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n        let self = this;\r\n        wx.showModal({\r\n            title: '提示',\r\n            content: '网络异常,拉取数据失败',\r\n            cancelText: '取消',\r\n            confirmText: '重试',\r\n            confirmColor: '#5B6A91',\r\n            success(res) {\r\n                if (res.confirm) {\r\n                    self.initLogin();\r\n                    chart.postMessage();\r\n                } else if (res.cancel) {\r\n\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 更新分数\r\n     * @param score 分数\r\n     */\r\n    public updateScore(score: number): Promise<any> {\r\n        let self = this;\r\n        return new Promise((reslove, reject) => {\r\n            if (typeof wx == \"undefined\") {\r\n                let userdata: data = {\r\n                    curscore: score,\r\n                    maxscore: score,\r\n                    maxweekscore: score,\r\n                    weeknum: -1\r\n                }\r\n                self.userDate = userdata;\r\n                reslove(true);\r\n            }\r\n\r\n            if (this.openId == '') {\r\n                reslove(false);\r\n                return;\r\n            }\r\n\r\n\r\n            wx.request({\r\n                url: self.getUrl('update_score'),\r\n                data: {\r\n                    \"openid\": self.openId,\r\n                    \"score\": score,\r\n                    \"version\": self._version,\r\n                    \"kids_version\": self._kidversion\r\n                },\r\n                method: \"POST\",\r\n                success(res) {\r\n                    reslove(true);\r\n                    if (res.data) {\r\n                        //有错误码\r\n                        if (res.data.error != null)\r\n                            return;\r\n                        let data = res.data.data;\r\n                        self.userDate = data;\r\n                        if (data.config.json != undefined)\r\n                            self.saveConfig(data.config);\r\n                        if (data.kids_config.json != undefined)\r\n                            self.saveConfig(data.kids_config, true);\r\n                        //最新分数比重传分数高,或者重传分数\r\n                        if (score >= self.score && self.score != 0) {\r\n                            self.score = 0;\r\n                            self.postMessage(postMessageName.updateScore, self.userDate);\r\n                        }\r\n                    }\r\n                    reslove(true)\r\n                },\r\n                fail(res) {\r\n                    //重传\r\n                    if (RootNode.currentScene == \"game\")\r\n                        self.scoreRetransmission(score);\r\n                    else//首界面,有重传数据\r\n                        self.haveScoreRetransmission();\r\n                    reslove(false)\r\n                    //重传\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 发送消息\r\n     * @param typeStr 类型\r\n     * @param valueObj 值\r\n     */\r\n    public postMessage(typeStr: string, valueObj: any) {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        //每次发消息,判断初始化不成功或者没有发送初始化消息给子域都需要尝试初始化\r\n        if (!this.initSuccess || !this.isSentInit) {\r\n            this.initLogin();\r\n        }\r\n\r\n        let openDataContext = wx.getOpenDataContext();\r\n        openDataContext.postMessage({\r\n            type: typeStr,\r\n            value: valueObj,\r\n        })\r\n        this.setUpdateWechatSubCanvas(typeStr);\r\n    }\r\n\r\n    /**\r\n     * 跳转界面\r\n     * @param scene 界面\r\n     */\r\n    public loadScene(scene: string) {\r\n        RootNode.currentScene = scene;\r\n        cc.director.loadScene(scene);\r\n        if (MySound.instance != undefined)\r\n            MySound.instance.crazy = false;\r\n    }\r\n\r\n    /**\r\n     * 分享按钮\r\n     */\r\n    public onShareBtn(num: number = 0) { //分享按钮\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        wx.aldShareAppMessage({\r\n            title: this.shareString.random(),\r\n            imageUrlId: this.imageUrlId[num],\r\n            imageUrl: this.imageUrl[num],\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 群排行\r\n     */\r\n    public onLookGroupBtnClicked() { //查看群排行按钮(实际是分享)\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n        wx.aldShareAppMessage({\r\n            title: this.groupString.random(),\r\n            imageUrlId: this.imageUrlId[0],\r\n            imageUrl: this.imageUrl[0],\r\n            query: \"type=group\",\r\n        })\r\n    };\r\n\r\n    /**\r\n     * 是否从群分享启动\r\n     */\r\n    public isLunchGroupShare(): string {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n        let self = this;\r\n        let res = wx.getLaunchOptionsSync();\r\n        let query = JSON.stringify(res.query);\r\n        let referrerinfo = JSON.stringify(res.referrerInfo);\r\n        let shareTicket = res.shareTicket;\r\n        wx.getSystemInfo({\r\n            success(date) {\r\n                //登入日志\r\n                let systemInfo = JSON.stringify(date);\r\n                self.gameLog.sendLaunchInfoLog(res.scene, query, shareTicket, referrerinfo, systemInfo);\r\n            }\r\n        })\r\n        if (res.query.type != \"group\")\r\n            return undefined;\r\n        return res.shareTicket;\r\n    }\r\n\r\n    /**\r\n    * 获取id(有id就是登入过)\r\n    */\r\n    public get openId() {\r\n        return this.getLocalStorage(storageKey.openid);\r\n    }\r\n\r\n    /**\r\n     * 获取版本号\r\n     */\r\n    public get version() {\r\n        return this._version;\r\n    }\r\n\r\n    /**\r\n     * 获取儿童版本号\r\n     */\r\n    public get kidVersion() {\r\n        return this._kidversion;\r\n    }\r\n\r\n    /**\r\n     * 获取是否为儿童版\r\n     */\r\n    public get isKid() {\r\n        return this._isKid;\r\n    }\r\n\r\n    /**\r\n    * 获取是否为儿童版\r\n    */\r\n    public set isKid(flag: boolean) {\r\n        if (this._isKid != flag) {\r\n            this._isKid = flag;\r\n            this.readGameConfig();\r\n            let value = flag ? 'yes' : 'no';\r\n            this.setLocalStorage(storageKey.isKid, value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 跳转到小程序\r\n     */\r\n    public jumpApp() {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        wx.navigateToMiniProgram({\r\n            appId: 'wxcc9d6a288b8edebd',\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 获取是否为新手\r\n     */\r\n    public get newPlayer() {\r\n        return this.getLocalStorage(storageKey.firstOpen) != \"no\";\r\n    }\r\n\r\n    /**\r\n     * 设置为非新手\r\n     */\r\n    public setNewPlayer() {\r\n        this.setLocalStorage(storageKey.firstOpen, \"no\");\r\n    }\r\n\r\n    /**\r\n     * load界面跳转游戏界面\r\n     */\r\n    public loadJump() {\r\n        this.loadScene(\"home\");\r\n    }\r\n\r\n    /**\r\n     * 配置读取生成速度\r\n     */\r\n    public getBallCreatDic(): any {\r\n        return this.config.ballCreatDic;\r\n    }\r\n\r\n    /**\r\n     * 配置读取重力信息\r\n     */\r\n    public getGravityDic(): any {\r\n        return this.config.gravityDic;\r\n    }\r\n\r\n    /**\r\n    * 配置读取生成概率信息\r\n    */\r\n    public getBallOddsDic(): any {\r\n        return this.config.ballOddsDic;\r\n    }\r\n\r\n    /**\r\n    * 配置读取疯狂模式信息\r\n    */\r\n    public getCrazyDic(): any {\r\n        return this.config.crazyDic;\r\n    }\r\n\r\n    /**\r\n     * 使用配置,当配置没有的时候再读一次\r\n     */\r\n    private get config() {\r\n        if (this._config == undefined)\r\n            this.readGameConfig();\r\n        return this._config;\r\n    }\r\n\r\n    /**\r\n     * 有重传分数,重传\r\n     */\r\n    public async haveScoreRetransmission() {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n        if (this.score == 0)\r\n            return;\r\n        let self = this;\r\n        wx.showModal({\r\n            title: '提示',\r\n            content: '当前有分数未上传成功,是否重试',\r\n            cancelText: '取消',\r\n            confirmText: '重试',\r\n            confirmColor: '#5B6A91',\r\n            success(res) {\r\n                if (res.confirm) {\r\n                    self.updateScore(self.score);\r\n                } else if (res.cancel) {\r\n                    self.score = 0;\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 读取是否为儿童版\r\n     */\r\n    private initKid() {\r\n        let value = this.getLocalStorage(storageKey.isKid);\r\n        this._isKid = value == 'yes';\r\n    }\r\n\r\n    /**\r\n    * 是否从app打开\r\n    */\r\n    private isLunchApp(): string {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n        let res = wx.getLaunchOptionsSync();\r\n        if (res.query.version == \"child\")\r\n            this.isKid = true;\r\n    }\r\n\r\n    /**\r\n    * 分数重传\r\n    */\r\n    private scoreRetransmission(score: number) {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        let self = this;\r\n\r\n        //保存的数据比本次高,不弹出框,等于0可能是初始化\r\n        if (this.score > score || score == 0)\r\n            return;\r\n        wx.showModal({\r\n            title: '提示',\r\n            content: '分数上传失败,请检测网络状态重试',\r\n            cancelText: '延后上传',\r\n            confirmText: '重试',\r\n            confirmColor: '#5B6A91',\r\n            success(res) {\r\n                if (res.confirm) {\r\n                    self.updateScore(score);\r\n                } else if (res.cancel) {\r\n                    self.score = score;\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n    * 登入信息初始化\r\n    */\r\n    private async initLogin() {\r\n        this.isLunchApp();\r\n\r\n        await this.LogIn();\r\n        await RootNode.instance.updateScore(0);\r\n\r\n        //初始化成功传递消息给子域\r\n        if (this.initSuccess) {\r\n            let value: any = {}\r\n            value.openid = this.openId;\r\n            value.weeknum = this.userDate.weeknum;\r\n            this.isSentInit = true;\r\n            this.postMessage(postMessageName.openId, value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 保存的分数信息\r\n     */\r\n    private get score() {\r\n        let value = this.getLocalStorage(storageKey.score)\r\n        if (value == undefined || value == '')\r\n            return 0;\r\n        return parseInt(value);\r\n    }\r\n\r\n    /**\r\n     * 设置保存分数\r\n     */\r\n    private set score(num: number) {\r\n        this.setLocalStorage(storageKey.score, num.toString());\r\n    }\r\n\r\n    /**\r\n     * 右上角\r\n     */\r\n    private initShareMenu() {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n        //开启右上角的分享\r\n        wx.showShareMenu();\r\n\r\n        //微信开启群分享\r\n        wx.updateShareMenu({\r\n            withShareTicket: true\r\n        })\r\n\r\n        let self = this;\r\n\r\n        wx.aldOnShareAppMessage(function (res) {\r\n            return {\r\n                title: self.shareString.random(),\r\n                imageUrlId: self.imageUrlId[0],\r\n                imageUrl: self.imageUrl[0],\r\n            }\r\n        })\r\n\r\n\r\n    }\r\n\r\n    /**\r\n   * 登入获取openId,主要为更新微信数据\r\n   */\r\n    private LogIn(): Promise<string> {\r\n        if (typeof wx == \"undefined\") {\r\n            return;\r\n        }\r\n        let self = this;\r\n        return new Promise((reslove, reject) => {\r\n            wx.login({\r\n                success(res) {\r\n                    if (res.code) {\r\n                        // 发起网络请求\r\n                        wx.request({\r\n                            url: self.getUrl('login_wx'),\r\n                            data: {\r\n                                code: res.code\r\n                            },\r\n                            method: \"POST\",\r\n                            success(res) {\r\n                                if (res.data) {\r\n                                    reslove(res.data.data.openid);\r\n\r\n                                    //有错误码,没有正确的取到openid\r\n                                    if (res.data.error != null)\r\n                                        return;\r\n                                    let openId = res.data.data.openid;\r\n                                    self.setLocalStorage(storageKey.openid, openId);\r\n                                } else {\r\n                                    reslove(\"res data error\");\r\n                                }\r\n\r\n                            },\r\n                            fail() {\r\n                                reslove(\"api failed\");\r\n                            }\r\n                        });\r\n                    } else {\r\n                        reslove(\"wx error\");\r\n                    }\r\n                },\r\n                fail() {\r\n                    reslove('failed')\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n\r\n    /**\r\n    * 获取是否为正式版\r\n    */\r\n    private release() {\r\n        if (typeof wx == \"undefined\") {\r\n            this.readGameConfig();\r\n            return;\r\n        }\r\n        let self = this;\r\n        // 发起网络请求\r\n        wx.request({\r\n            url: self.getUrl(\"is_release\"),\r\n            method: \"POST\",\r\n            success(res) {\r\n                if (res.data) {\r\n                    self.isRelease = res.data.data.is_release;\r\n                }\r\n            },\r\n            complete() {\r\n                self.readGameConfig();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 设置子域更新\r\n     * @param typeStr 消息类型\r\n     */\r\n    private async setUpdateWechatSubCanvas(typeStr: string) {\r\n        //清除未完成的计时器\r\n        this.unscheduleAllCallbacks();\r\n        //排行榜\r\n        if (typeStr == postMessageName.charts || typeStr == postMessageName.group) {\r\n            this.wxSubView.enabled = true;\r\n        }\r\n        else if (typeStr != postMessageName.openId && typeStr != postMessageName.updateScore) //给子域发送id 和 更新分数不需要改变子域界面 \r\n        {\r\n            this.wxSubView.enabled = true;\r\n            this.scheduleOnce(() => {\r\n                this.wxSubView.enabled = false;\r\n            }, 5);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取配置信息\r\n     */\r\n    private readGameConfig() {\r\n        //初始配置版号\r\n        this.initVersion();\r\n        let key = this.isRelease ? \"release\" : \"test\";\r\n        let type = this.isKid ? \"kid\" : \"adult\";\r\n        key = type + \"_\" + key + \"_\" + storageKey.config;\r\n        let value = this.getLocalStorage(key);\r\n        if (value != \"\" && value != undefined) {\r\n            let data = JSON.parse(value);\r\n            this._config = data.json;\r\n        } else {\r\n            let self = this;\r\n            let resouseKey = this.isKid ? 'GameConfig_child.json' : 'GameConfig.json';\r\n            cc.loader.loadRes(resouseKey, function (err, object) {\r\n                if (err) {\r\n                    return;\r\n                }\r\n                let version = self.isKid ? self._kidversion : self._version;\r\n                if (version > object.json.version)\r\n                    return;\r\n                self._config = object.json.json;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n    * 初始设置版号\r\n    */\r\n    private initVersion() {\r\n        let release = this.isRelease ? \"release\" : \"test\";\r\n        for (let i = 0; i < 2; i++) {\r\n            let type = i == 0 ? \"kid\" : \"adult\";\r\n            let key = type + \"_\" + release + \"_\" + storageKey.config;\r\n            let value = this.getLocalStorage(key);\r\n            if (value != \"\" && value != undefined) {\r\n                let data = JSON.parse(value);\r\n                if (i == 0)\r\n                    this._kidversion = Number(data.version);\r\n                else\r\n                    this._version = Number(data.version);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 保存配置\r\n     * @param data 配置\r\n     * @param kid 是否为儿童版\r\n     */\r\n    private saveConfig(data: any, kid: boolean = false) {\r\n        if (kid)\r\n            this._kidversion = data.version;\r\n        else\r\n            this._version = data.version;\r\n\r\n        if (this.isKid == kid)\r\n            this._config = data.json;\r\n        let key = this.isRelease ? \"release\" : \"test\";\r\n        let type = kid ? \"kid\" : \"adult\";\r\n        key = type + \"_\" + key + \"_\" + storageKey.config;\r\n        this.setLocalStorage(key, JSON.stringify(data));\r\n    }\r\n\r\n    /**\r\n     * 获取url\r\n     * @param str 字符登入还是更新分数\r\n     */\r\n    private getUrl(str: string): string {\r\n        return this.urlhead + str;\r\n    }\r\n}"]}