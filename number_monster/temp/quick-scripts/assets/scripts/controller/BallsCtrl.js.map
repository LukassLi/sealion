{"version":3,"sources":["BallsCtrl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["// Copyright (C) 2019, Flickering Inc. All rights reserved.\r\n// Author: hongchangfu (hongchangfu@flickering.ai)\r\n\r\n//球操作的控制\r\n\r\nimport { comboSpeed } from \"../GameConfig\";\r\nimport Ball from \"../view/Ball\";\r\nimport ComBo from \"../view/ComBo\";\r\nimport GameCtrl from \"./GameCtrl\";\r\nimport MySound, { AudioType } from \"../MySound\";\r\nimport RootNode from \"../RootNode\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BallsCtrl {\r\n    /** 连击数 */\r\n    private combo: number = 0;\r\n\r\n    /** 10球对象池*/\r\n    private tenArr: Array<cc.Node> = [];\r\n\r\n    /** comBo对象池 */\r\n    private comBoArr: Array<ComBo> = [];\r\n\r\n    /**\r\n     * 选中球,手指停止触碰处理\r\n     */\r\n    public touchEnd() {\r\n        if (!this.isCrazeTriggerBallValidAdd())\r\n            return;\r\n        let triggerBall = GameCtrl.instance.triggerBall;\r\n        let moveBall = GameCtrl.instance.slectBall;\r\n        let num = triggerBall.ballNum + moveBall.ballNum;\r\n\r\n        //疯狂模式不能大于15\r\n        if (num > 15 && GameCtrl.instance.crazy)\r\n            return;\r\n        if (num != 10)\r\n            this.addNormal(num);\r\n        else\r\n            this.addTen()\r\n        this.ballAddDisappear(triggerBall);\r\n        let pos = triggerBall.node.position;\r\n        this.moveAddDisappear(moveBall, pos);\r\n        GameCtrl.instance.triggerBall = undefined;\r\n\r\n        //记录合并\r\n        RootNode.instance.gameLog.recordAction('c', triggerBall.ballNum, moveBall.ballNum);\r\n\r\n        //引导\r\n        if (GameCtrl.instance.guide)\r\n            GameCtrl.instance.guide.nextGuide(1);\r\n    }\r\n\r\n    /**\r\n     * 选中球双击处理\r\n     * @param ball 选中球\r\n     */\r\n    public ballDoubleClick(ball: Ball) {\r\n        let num = ball.ballNum;\r\n        if (!this.isValidDoubleClick(num))\r\n            return;\r\n\r\n        MySound.instance.playAudio(AudioType.Split);\r\n        let num1 = Math.ceil(num / 2);\r\n        let num2 = num - num1;\r\n        let pos = ball.node.position;\r\n        GameCtrl.instance.creatBall.ballRecovery(ball);\r\n        this.creatForDouble(num1, pos);\r\n        let ball2 = this.creatForDouble(num2, pos, false);\r\n        let v = new cc.Vec2(0, 260);\r\n        ball2.speedDelay(v, 0.1);\r\n        this.combo = 0;\r\n\r\n        //记录拆分\r\n        RootNode.instance.gameLog.recordAction('s', num);\r\n    }\r\n\r\n    /**\r\n     * 游戏开始连击重置\r\n     */\r\n    public reset() {\r\n        this.combo = 0;\r\n    }\r\n\r\n    /**\r\n     * 是否为有效的双击拆分\r\n     */\r\n    private isValidDoubleClick(num: number): boolean {\r\n        //引导时,第五步双击引导,双击数字6才能拆\r\n        let guide = GameCtrl.instance.guide\r\n        if (guide) {\r\n            if (guide.Index == 5 && num == 6) {\r\n                guide.nextGuide();\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 是否为有效的疯狂模式触发球相加\r\n     */\r\n    private isCrazeTriggerBallValidAdd(): boolean {\r\n        let triggerBall = GameCtrl.instance.triggerBall;\r\n        let moveBall = GameCtrl.instance.slectBall;\r\n        if (triggerBall == undefined)\r\n            return false;\r\n        //有触发球\r\n        if (GameCtrl.instance.creatBall.crazyTrigerBall) {\r\n            //判断的两球中有触发球\r\n            if (triggerBall.crazyBall || moveBall.crazyBall) {\r\n                //不为10 均为无效\r\n                if (triggerBall.ballNum + moveBall.ballNum != 10)\r\n                    return false;\r\n                else //等到合10特效结束,触发疯狂模式\r\n                {\r\n                    //合了疯狂球就立刻结束判断,等待进入疯狂模式\r\n                    GameCtrl.instance.topStrip.stopJudgment();\r\n\r\n                    GameCtrl.instance.crazyDelay(true,38/30);\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 选中球消失 5帧数 30为帧率\r\n     * @param ball 选中球\r\n     * @param pos 消失位置\r\n     */\r\n    private moveAddDisappear(ball: Ball, pos: cc.Vec2) {\r\n        ball.rigid.active = false;\r\n        let move = cc.moveTo(5 / 30, pos);\r\n        let disappear = this.addDisappear(ball);\r\n        let spa = cc.spawn([move, disappear]);\r\n        ball.node.runAction(spa);\r\n    }\r\n\r\n    /**\r\n     * 触发球消失 5帧数 30为帧率\r\n     * @param ball 触发球\r\n     */\r\n    private ballAddDisappear(ball: Ball) {\r\n        ball.rigid.active = false;\r\n        let delay = cc.delayTime(5 / 30);\r\n        let action = this.addDisappear(ball);\r\n        let sqe = cc.sequence(delay, action);\r\n        ball.node.runAction(sqe);\r\n    }\r\n\r\n    /**\r\n     * 球在相加时,消失的动画 5帧数 30为帧率\r\n     * @param ball 消失的球\r\n     */\r\n    private addDisappear(ball: Ball): cc.ActionInterval {\r\n        let fun = cc.callFunc(() => {\r\n            GameCtrl.instance.creatBall.ballRecovery(ball);\r\n        });\r\n        let scale = cc.scaleTo(5 / 30, 0);\r\n        let fade = cc.fadeTo(5 / 30, 0);\r\n        let spa = cc.spawn([scale, fade]);\r\n        let seq = cc.sequence([spa, fun]);\r\n        return seq;\r\n    }\r\n\r\n    /**\r\n     * 普通加\r\n     * @param num 相加后生成的球数字\r\n     */\r\n    private addNormal(num: number) {\r\n        this.combo = 0;\r\n        let pos = GameCtrl.instance.triggerBall.node.position;\r\n        if (num > 15) {\r\n            MySound.instance.playAudio(AudioType.GreaterThanFifteen);\r\n            let boom = GameCtrl.instance.ballboom;\r\n            boom.active = true;\r\n            boom.position = pos;\r\n            this.playAnimation(boom, \"boom\");\r\n            GameCtrl.instance.gameOver(1);\r\n            return;\r\n        }\r\n        this.addCreatBall(num, pos);\r\n    }\r\n\r\n    /**\r\n     * 相加生成球 4 6 1 为帧数 30为帧率\r\n     * @param num 球的数字\r\n     * @param pos 球的位置\r\n     */\r\n    private addCreatBall(num: number, pos: cc.Vec2) {\r\n        if (num > 10)\r\n            MySound.instance.playAudio(AudioType.GreaterThanTen);\r\n        else\r\n            MySound.instance.playAudio(AudioType.LessThanTen);\r\n        let ballNode = GameCtrl.instance.creatBall.creatBallForPos(num, pos);\r\n        ballNode.scale = 0.01;\r\n        ballNode.opacity = 0;\r\n        let delay = cc.delayTime(4 / 30);\r\n        let spa = cc.spawn([\r\n            cc.scaleTo(6 / 30, 1),\r\n            cc.fadeTo(1 / 30, 255)\r\n        ])\r\n        let seq = cc.sequence([delay, spa]);\r\n        ballNode.runAction(seq);\r\n\r\n        if (GameCtrl.instance.guide)\r\n            ballNode.parent = GameCtrl.instance.guide.node;\r\n    }\r\n\r\n    /**\r\n     * 相加等于10\r\n     */\r\n    private addTen() {\r\n        if (GameCtrl.instance.crazy)\r\n            GameCtrl.instance.addScore = GameCtrl.instance.crazyComboAdd;\r\n        else {\r\n            this.combo++;\r\n            if (this.combo > 10)\r\n                this.combo = 10;\r\n            GameCtrl.instance.addScore = this.combo * 10;\r\n        }\r\n        let pos = GameCtrl.instance.triggerBall.node.position;\r\n        this.creatTen(pos);\r\n        this.creatCombo(pos);\r\n    }\r\n\r\n    /**\r\n     * 10球生成 25为帧数 30为帧率\r\n     * @param pos 位置\r\n     */\r\n    private creatTen(pos: cc.Vec2) {\r\n        MySound.instance.playAudio(AudioType.Ten);\r\n        let instance = GameCtrl.instance;\r\n        let node: cc.Node = undefined;\r\n        if (this.tenArr.length > 0)\r\n            node = this.tenArr.pop();\r\n        else {\r\n            node = cc.instantiate(instance.ballPreArr[9]);\r\n        }\r\n        let recover = cc.sequence([\r\n            cc.delayTime(25 / 30),\r\n            cc.callFunc(() => {\r\n                this.tenArr.push(node);\r\n            })\r\n        ]);\r\n        if (instance.guide)\r\n            node.setParent(instance.maskPanl.parent);\r\n        else\r\n            node.setParent(instance.gameNode);\r\n        node.position = pos;\r\n        node.zIndex = 3;\r\n        this.playAnimation(node, \"ball_10\", comboSpeed);\r\n        node.runAction(recover);\r\n    }\r\n\r\n    /**\r\n     * 连击生成 38为第几帧 30 为帧率\r\n     * @param pos 位置\r\n     */\r\n    private creatCombo(pos: cc.Vec2) {\r\n        if (GameCtrl.instance.crazy)\r\n            MySound.instance.playAudio(AudioType.ComboGood, 20 / 30);\r\n        else if (this.combo == 10)\r\n            MySound.instance.playAudio(AudioType.ComboTen, 20 / 30);\r\n        else if (this.combo > 1)\r\n            MySound.instance.playAudio(AudioType.ComboGood, 20 / 30);\r\n        let instance = GameCtrl.instance;\r\n        let combo: ComBo = undefined;\r\n        let node: cc.Node = undefined;\r\n        if (this.comBoArr.length > 0)\r\n            combo = this.comBoArr.pop();\r\n        else {\r\n            node = cc.instantiate(instance.comBoPre);\r\n            combo = node.getComponent(ComBo);\r\n        }\r\n        let recover = cc.sequence([\r\n            cc.delayTime(38 / 30),\r\n            cc.callFunc(() => {\r\n                this.comBoArr.push(combo);\r\n            })\r\n        ]);\r\n        combo.setCombo(this.combo);\r\n        node = combo.node;\r\n        node.position = pos;\r\n        this.playAnimation(node, \"combo\", comboSpeed);\r\n        node.runAction(recover);\r\n        if (instance.guide)\r\n            node.setParent(instance.maskPanl.parent);\r\n        else\r\n            node.setParent(instance.gameNode);\r\n    }\r\n\r\n    /**\r\n     * 播放动画\r\n     * @param node 节点\r\n     * @param ani 播放动画名字\r\n     */\r\n    private playAnimation(node: cc.Node, ani: string, speed: number = 1) {\r\n        let anim = node.getComponent(cc.Animation);\r\n        let animState = anim.play(ani);\r\n        animState.speed = speed;\r\n    }\r\n\r\n    /**\r\n     * 双击生成球\r\n     * @param num 球的数字\r\n     * @param pos 位置\r\n     * @param active 生成时刚体是否有效\r\n     */\r\n    private creatForDouble(num: number, pos: cc.Vec2, active: boolean = true): Ball {\r\n        let node = GameCtrl.instance.creatBall.creatBallForPos(num, pos);\r\n        let ball = node.getComponent(Ball);\r\n        node.scale = 0;\r\n        ball.rigid.active = active;\r\n        let action = cc.sequence(\r\n            cc.scaleTo(0.2, 1),\r\n            cc.callFunc(() => {\r\n                ball.rigid.active = true;\r\n            })\r\n        )\r\n        node.runAction(action);\r\n\r\n        if (GameCtrl.instance.guide)\r\n            node.parent = GameCtrl.instance.guide.node;\r\n        return ball;\r\n    }\r\n}"]}