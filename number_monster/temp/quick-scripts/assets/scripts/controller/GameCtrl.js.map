{"version":3,"sources":["GameCtrl.ts"],"names":[],"mappings":";;;;AAAA,2DAA2D;AAC3D,kDAAkD;;AAElD,QAAQ;AAER,qCAAgC;AAChC,yCAAoC;AACpC,yCAAoC;AACpC,4CAAqD;AACrD,6CAAwC;AACxC,sCAAgD;AAChD,wCAAmC;AACnC,+CAA0C;AAEpC,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAG5C;IAAsC,4BAAQ;IAD9C;QAAA,qEAkoBC;QA9nBG,oBAAoB;QACb,mBAAa,GAAW,EAAE,CAAC;QAElC,aAAa;QACN,eAAS,GAAS,SAAS,CAAC;QAEnC,cAAc;QACP,cAAQ,GAAc,SAAS,CAAC;QAEvC,mBAAmB;QACZ,kBAAY,GAAmB,EAAE,CAAC;QAEzC,iBAAiB;QACV,iBAAW,GAAG,CAAC,CAAC;QAEvB,SAAS;QACF,WAAK,GAAc,SAAS,CAAC;QAEpC,SAAS;QACD,YAAM,GAAW,CAAC,CAAC;QAE3B,qBAAqB;QACb,uBAAiB,GAAW,SAAS,CAAC;QAE9C,sBAAsB;QACd,sBAAgB,GAAW,SAAS,CAAC;QAE7C,qBAAqB;QACb,yBAAmB,GAAW,SAAS,CAAC;QAEhD,gBAAgB;QACR,kBAAY,GAAW,CAAC,CAAC;QAEjC,eAAe;QACP,mBAAa,GAAW,SAAS,CAAC;QAE1C,aAAa;QACL,kBAAY,GAAS,SAAS,CAAC;QAEvC,SAAS;QACD,eAAS,GAAY,KAAK,CAAC;QAEnC,WAAW;QACH,eAAS,GAAY,KAAK,CAAC;QAEnC,WAAW;QACJ,oBAAc,GAAsB,SAAS,CAAC;;IAglBzD,CAAC;iBAjoBoB,QAAQ;IAmDzB,yBAAM,GAAN;QACI,UAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC;QAEtD,IAAI,CAAC,cAAc,CAAC,OAAO,GAAG,IAAI,CAAC;QACnC,EAAE,CAAC,cAAc,CAAC,mBAAmB,GAAG,EAAE,CAAC;IAC/C,CAAC;IAED,wBAAK,GAAL;QAAA,iBAiCC;QAhCG,IAAI,CAAC,QAAQ,GAAG,IAAI,mBAAS,EAAE,CAAC;QAEhC,YAAY;QACZ,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,mBAAS,CAAC,CAAC;QAEnD,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC,6BAA6B,EAAE,CAAC;QACrC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC;QAE3C,YAAY;QACZ,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,EAAE,CAAC;QAEnD,iBAAO,CAAC,QAAQ,CAAC,SAAS,CAAC,mBAAS,CAAC,SAAS,CAAC,CAAC;QAChD,IAAI,MAAM,GAAG,EAAE,CAAC,QAAQ,CAAC;YACrB,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC;YACjB,EAAE,CAAC,QAAQ,CAAC;gBACR,KAAI,CAAC,QAAQ,EAAE,CAAC;YACpB,CAAC,CAAC;SACL,CAAC,CAAA;QACF,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAC5B,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAErC,aAAa;QACb,kBAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;QAE1C,aAAa;QACb,IAAI,kBAAQ,CAAC,QAAQ,CAAC,SAAS,EAAE;YAC7B,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;YAC5B,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC;SAC7B;QAED,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC7B,CAAC;IAKD,sBAAW,8BAAQ;QAHnB;;WAEG;aACH,UAAoB,GAAW;YAA/B,iBAoBC;YAnBG,IAAI,CAAC,MAAM,IAAI,GAAG,CAAC;YAEnB,aAAa;YACb,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;gBACb,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,iBAAiB;oBACpC,IAAI,CAAC,gBAAgB,EAAE,CAAC;gBAC5B,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,gBAAgB;oBACnC,IAAI,CAAC,cAAc,EAAE,CAAC;gBAC1B,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,mBAAmB;oBACtC,IAAI,CAAC,aAAa,EAAE,CAAC;gBACzB,IAAI,CAAC,YAAY,EAAE,CAAC;aACvB;YACD,IAAI,YAAY,GAAG,EAAE,CAAC,QAAQ,CAAC;gBAC3B,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC;gBACf,EAAE,CAAC,QAAQ,CAAC;oBACR,KAAI,CAAC,UAAU,CAAC,MAAM,GAAG,KAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;gBACpD,CAAC,CAAC;aACL,CAAC,CAAC;YACH,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;QACtC,CAAC;;;OAAA;IAKD,sBAAW,2BAAK;QAHhB;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,MAAM,CAAC;QACvB,CAAC;;;OAAA;IAED,sBAAW,0CAAoB;aAA/B,UAAgC,OAAgB;YAC5C,IAAI,IAAI,CAAC,cAAc,CAAC,OAAO,IAAI,OAAO;gBACtC,OAAO;YACX,IAAI,CAAC,cAAc,CAAC,OAAO,GAAG,OAAO,CAAC;QAC1C,CAAC;;;OAAA;IAKD,sBAAW,iCAAW;QAQtB;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,YAAY,CAAC;QAC7B,CAAC;QAhBD;;WAEG;aACH,UAAuB,IAAU;YAC7B,IAAI,IAAI,CAAC,YAAY;gBACjB,IAAI,CAAC,YAAY,CAAC,UAAU,GAAG,KAAK,CAAC;YACzC,IAAI,IAAI;gBACJ,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YAC3B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QAC7B,CAAC;;;OAAA;IASD;;OAEG;IACI,8BAAW,GAAlB;QACI,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IACtB,CAAC;IAED;;OAEG;IACI,6BAAU,GAAjB;QACI,aAAa;QACb,kBAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;QAEvC,iBAAO,CAAC,QAAQ,CAAC,SAAS,CAAC,mBAAS,CAAC,MAAM,CAAC,CAAC;QAC7C,kBAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACxC,CAAC;IAKD,sBAAW,2BAAK;QAgEhB;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,SAAS,CAAC;QAC1B,CAAC;QAxED;;WAEG;aACH,UAAiB,IAAa;YAC1B,iBAAO,CAAC,QAAQ,CAAC,SAAS,CAAC,mBAAS,CAAC,MAAM,CAAC,CAAC;YAC7C,IAAI,CAAC,cAAc,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC;YACpC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,IAAI,CAAC;YAC7B,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,IAAI,CAAC;YAE5B,kBAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;YAChD,kBAAkB;YAClB,IAAI,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE;gBAC/B,IAAI,GAAG,GAAG,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBAC7C,IAAI,IAAI;oBACJ,GAAG,CAAC,eAAe,EAAE,CAAC;;oBAEtB,GAAG,CAAC,gBAAgB,EAAE,CAAC;aAC9B;QACL,CAAC;;;OAAA;IAKD,sBAAW,gCAAU;QAHrB;;WAEG;aACH,UAAsB,IAAa;YAC/B,qBAAqB;YACrB,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM;gBAC7C,OAAO;YACX,IAAI,CAAC,cAAc,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC;YACpC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,IAAI,CAAC;QAChC,CAAC;;;OAAA;IAKD,sBAAW,2BAAK;QAHhB;;WAEG;aACH;YACI,OAAO,IAAI,CAAC,SAAS,CAAC;QAC1B,CAAC;QAcD;;WAEG;aACH,UAAiB,IAAa;YAC1B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;YAC3B,IAAI,IAAI;gBACJ,IAAI,CAAC,UAAU,EAAE,CAAC;;gBAElB,IAAI,CAAC,YAAY,EAAE,CAAC;YAExB,IAAI,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,WAAW,CAAC;YAC7C,kBAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;QAChD,CAAC;;;OA3BA;IAED;;;;OAIG;IACI,6BAAU,GAAjB,UAAkB,IAAa,EAAE,KAAiB;QAAlD,iBAKC;QALgC,sBAAA,EAAA,SAAiB;QAC9C,IAAI,QAAQ,GAAG;YACX,KAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QACtB,CAAC,CAAA;QACD,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;IACvC,CAAC;IAwBD;;OAEG;IACI,2BAAQ,GAAf;QACI,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;IACvB,CAAC;IAED;;OAEG;IACI,yBAAM,GAAb;QACI,iBAAO,CAAC,QAAQ,CAAC,SAAS,CAAC,mBAAS,CAAC,MAAM,CAAC,CAAC;QAC7C,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;QAChB,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEzB,eAAe;QACf,IAAI,IAAI,CAAC,KAAK;YACV,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;aACrB;YACD,IAAI,CAAC,SAAS,EAAE,CAAC;YACjB,IAAI,CAAC,QAAQ,EAAE,CAAC;SACnB;QAED,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;QACrB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC5B,IAAI,CAAC,cAAc,CAAC,OAAO,GAAG,IAAI,CAAC;IACvC,CAAC;IAED;;;OAGG;IACI,2BAAQ,GAAf,UAAgB,SAAqB;QAArC,iBAgBC;QAhBe,0BAAA,EAAA,aAAqB;QACjC,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC;QAC7B,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;QAC3B,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,cAAc,CAAC,OAAO,GAAG,KAAK,CAAC;QACpC,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,GAAG,GAAG,EAAE,CAAC,QAAQ,CAAC;YAClB,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC;YACvB,EAAE,CAAC,QAAQ,CAAC;gBACR,IAAI,KAAI,CAAC,WAAW,GAAG,CAAC;oBACpB,KAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;;oBAEpB,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACnC,CAAC,CAAC;SACL,CAAC,CAAC;QACH,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;IAC7B,CAAC;IAED;;OAEG;IACI,mCAAgB,GAAvB;QACI,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC;QACnC,IAAI,KAAK,GAAG,EAAE,CAAC;QACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACnC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM;gBAChB,SAAS;YACb,IAAI,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC;YACvC,IAAI,IAAI;gBACJ,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACxB;QACD,OAAO,KAAK,CAAC;IACjB,CAAC;IAED;;OAEG;IACI,8BAAW,GAAlB;QAAA,iBAmBC;QAlBG,MAAM;QACN,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACxC,iBAAO,CAAC,QAAQ,CAAC,SAAS,CAAC,mBAAS,CAAC,SAAS,CAAC,CAAC;QAChD,IAAI,MAAM,GAAG,EAAE,CAAC,QAAQ;QACpB,aAAa;QACb,EAAE,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC,EACrB,EAAE,CAAC,QAAQ,CAAC;YACR,KAAI,CAAC,SAAS,EAAE,CAAC;QACrB,CAAC,CAAC;QAEF,cAAc;QACd,EAAE,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC,EACrB,EAAE,CAAC,QAAQ,CAAC;YACR,KAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,KAAI,CAAC,cAAc,CAAC,OAAO,GAAG,IAAI,CAAC;QACvC,CAAC,CAAC,CACL,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAChC,CAAC;IAED;;OAEG;IACI,2BAAQ,GAAf;QACI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,KAAK,CAAC;QAC7B,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;QAC3B,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;QACvB,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;IACrC,CAAC;IAED;;OAEG;IACK,6BAAU,GAAlB;QACI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;QAC5B,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC;QAC1B,IAAI,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACjC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACpC,CAAC;IAED;;OAEG;IACK,gDAA6B,GAArC;QACI,IAAI,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC;QACrC,IAAI,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC;QAC5C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACjC,IAAI,KAAK,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;YAC3B,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YACnB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACjC;IACL,CAAC;IAED;;OAEG;IACK,mCAAgB,GAAxB;QAAA,iBASC;QARG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,UAAC,CAAC;YAC7C,KAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;QACxB,CAAC,CAAC,CAAC;QAEH,kBAAQ,CAAC,QAAQ,CAAC,SAAS,GAAG,UAAC,GAAG;YAC9B,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAC5B,KAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QAC3B,CAAC,CAAA;IACL,CAAC;IAED;;;OAGG;IACK,8BAAW,GAAnB,UAAoB,KAA0B;QAC1C,IAAI,IAAI,CAAC,SAAS,IAAI,SAAS;YAC3B,OAAO;QACX,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,oBAAoB,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;QAClE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IAChC,CAAC;IAED;;OAEG;IACK,2BAAQ,GAAhB;QACI,kBAAQ,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC;QAC9B,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;QACtB,IAAI,CAAC,SAAS,CAAC,cAAc,GAAG,SAAS,CAAC;QAC1C,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;QACtB,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;QAChD,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;QAC5B,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,CAAC;IAED;;OAEG;IACK,8BAAW,GAAnB;QACI,WAAW;QACX,IAAI,kBAAQ,CAAC,QAAQ,CAAC,SAAS,EAAE;YAC7B,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,CAAC;YAC5B,IAAI,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACzC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;YACnC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,mBAAS,CAAC,CAAC;YAC1C,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;SACrB;;YACG,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;IACnC,CAAC;IAED;;OAEG;IACK,mCAAgB,GAAxB;QACI,IAAI,QAAQ,GAAG,oBAAU,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC3D,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,UAAU,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;IAC5C,CAAC;IAED;;OAEG;IACK,gCAAa,GAArB;QACI,IAAI,UAAU,GAAG,oBAAU,CAAC,qBAAqB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC/D,IAAI,CAAC,mBAAmB,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;QACzC,IAAI,CAAC,cAAc,CAAC,OAAO,GAAG,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;IACjE,CAAC;IAED;;OAEG;IACK,iCAAc,GAAtB;QACI,IAAI,OAAO,GAAG,oBAAU,CAAC,kBAAkB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACzD,IAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;QACnC,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;IAC7C,CAAC;IAED;;MAEE;IACM,+BAAY,GAApB;QACI,oBAAoB;QACpB,IAAI,IAAI,CAAC,SAAS,CAAC,cAAc,IAAI,SAAS;YAC1C,OAAO;QACX,IAAI,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,MAAM;YAC/B,OAAO;QACX,IAAI,SAAS,GAAG,oBAAU,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC5D,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;QACjC,IAAI,CAAC,SAAS,CAAC,cAAc,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;QAE7C,6FAA6F;QAC7F,IAAI,KAAK,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;QAC1C,IAAI,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC3B,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;QAC5B,IAAI,CAAC,SAAS,CAAC,eAAe,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;IAClD,CAAC;IAED;;OAEG;IACK,6BAAU,GAAlB;QAAA,iBAmBC;QAlBG,MAAM;QACN,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC1C,iBAAO,CAAC,QAAQ,CAAC,SAAS,CAAC,mBAAS,CAAC,SAAS,CAAC,CAAC;QAChD,IAAI,MAAM,GAAG,EAAE,CAAC,QAAQ;QACpB,aAAa;QACb,EAAE,CAAC,SAAS,CAAC,CAAC,GAAG,EAAE,CAAC,EACpB,EAAE,CAAC,QAAQ,CAAC;YACR,KAAI,CAAC,SAAS,EAAE,CAAC;YACjB,KAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC,CAAC;QACF,gBAAgB;QAChB,EAAE,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC,EACrB,EAAE,CAAC,QAAQ,CAAC;YACR,KAAI,CAAC,cAAc,EAAE,CAAC;YACtB,KAAI,CAAC,WAAW,EAAE,CAAC;QACvB,CAAC,CAAC,CACL,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAChC,CAAC;IAED;;MAEE;IACM,8BAAW,GAAnB;QACI,6FAA6F;QAC7F,IAAI,KAAK,GAAG,oBAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACrD,IAAI,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC3B,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QACtC,IAAI,CAAC,SAAS,CAAC,UAAU,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3C,IAAI,CAAC,cAAc,CAAC,OAAO,GAAG,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QACtD,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;QAC3B,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;IAChC,CAAC;IAED;;OAEG;IACK,+BAAY,GAApB;QAAA,iBA2BC;QA1BG,aAAa;QACb,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;QAC5B,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC;QAE1B,QAAQ;QACR,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC;QAC7B,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC3C,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,KAAK,CAAC;QACtC,IAAI,MAAM,GAAG,EAAE,CAAC,QAAQ;QACpB,cAAc;QACd,EAAE,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC,EACrB,EAAE,CAAC,QAAQ,CAAC;YACR,KAAI,CAAC,SAAS,EAAE,CAAC;YACjB,KAAI,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC;YAChC,KAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC,CAAC;QAEF,cAAc;QACd,EAAE,CAAC,SAAS,CAAC,CAAC,GAAG,EAAE,CAAC,EACpB,EAAE,CAAC,QAAQ,CAAC;YACR,KAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,KAAK,CAAC;YAC7B,KAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,KAAI,CAAC,cAAc,CAAC,OAAO,GAAG,IAAI,CAAC;QACvC,CAAC,CAAC,CACL,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAChC,CAAC;IAED;;OAEG;IACK,iCAAc,GAAtB;QAAA,iBAqBC;QApBG,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC;QAC9B,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,IAAI,CAAC;QACrC,IAAI,GAAG,GAAG,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QAC7C,IAAI,MAAM,GAAG,GAAG,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QAEzC,GAAG,CAAC,cAAc,EAAE,CAAC;QACrB,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QACtC,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC;QACd,IAAI,MAAM,GAAG,EAAE,CAAC,QAAQ,CACpB,EAAE,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,EAChC,EAAE,CAAC,QAAQ,CAAC;YACR,MAAM,CAAC,WAAW,GAAG,KAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QAC1C,CAAC,CAAC,EACF,EAAE,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,EAC7B,EAAE,CAAC,QAAQ,CAAC;YACR,KAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,KAAK,CAAC;YACtC,KAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACvB,CAAC,CAAC,CACL,CAAA;QACD,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IAC1B,CAAC;IAED;;OAEG;IACK,gCAAa,GAArB;QACI,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7B,OAAO;QACP,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAC1E,IAAI,CAAC,QAAQ,CAAC,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QACpD,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACrF,IAAI,CAAC,WAAW,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QACpD,IAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;QACjC,OAAO,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAEjE,IAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC;QACvC,OAAO,CAAC,WAAW,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;QAElC,iBAAO,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC7C,CAAC;IAGD;;OAEG;IACK,6BAAU,GAAlB;QACI,IAAI,MAAM,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACrC,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;QAC3B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE;YAC7B,IAAI,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,WAAW,CAAC,qBAAQ,CAAC,GAAG,CAAC,CAAC;SAClC;IACL,CAAC;IAED;;MAEE;IACM,4BAAS,GAAjB;QACI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,KAAK,CAAC;QAC7B,IAAI,MAAM,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACrC,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;QAC3B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE;YAC7B,IAAI,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;SACrC;IACL,CAAC;IAED;;;;OAIG;IACK,gCAAa,GAArB,UAAsB,MAAiB,EAAE,IAAgB;QAAhB,qBAAA,EAAA,QAAgB;QACrD,IAAI,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAClC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;QACnC,UAAU;QACV,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;QAChB,IAAI,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;QAChD,IAAI,SAAS,GAAG,SAAS,CAAC,IAAI,EAAE,CAAC;QACjC,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC;QAC7C,IAAI;QACJ,IAAI,CAAC,YAAY,CAAC;YACd,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC5B,CAAC,EAAE,IAAI,CAAC,CAAA;QACR,OAAO,IAAI,CAAC;IAChB,CAAC;IAEO,oCAAiB,GAAzB;QAEI,IAAG,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE;YACxB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;;YAErB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;IAC7B,CAAC;;IA9nBa,iBAAQ,GAAa,SAAS,CAAC;IAD5B,QAAQ;QAD5B,OAAO;OACa,QAAQ,CAioB5B;IAAD,eAAC;CAjoBD,AAioBC,CAjoBqC,kBAAQ,GAioB7C;kBAjoBoB,QAAQ","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["// Copyright (C) 2019, Flickering Inc. All rights reserved.\r\n// Author: hongchangfu (hongchangfu@flickering.ai)\r\n\r\n//游戏逻辑控制\r\n\r\nimport Ball from \"../view/Ball\";\r\nimport BallsCtrl from \"./BallsCtrl\";\r\nimport CreatBall from \"./CreatBall\";\r\nimport GameConfig, { EyeState } from \"../GameConfig\";\r\nimport GameView from \"../view/GameView\";\r\nimport MySound, { AudioType } from \"../MySound\";\r\nimport RootNode from \"../RootNode\";\r\nimport GameGuide from \"../view/GameGuide\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameCtrl extends GameView {\r\n    public static instance: GameCtrl = undefined;\r\n\r\n    /** 疯狂模式combo 加的分 */\r\n    public crazyComboAdd: number = 50;\r\n\r\n    /** 点击选中的球 */\r\n    public slectBall: Ball = undefined;\r\n\r\n    /** 球操作控制函数 */\r\n    public ballsCtr: BallsCtrl = undefined;\r\n\r\n    /** 底部多边形碰撞组件点数组 */\r\n    public bottomPoints: Array<cc.Vec2> = [];\r\n\r\n    /** 每一局可以复活的次数 */\r\n    public revivalTime = 1;\r\n\r\n    /** 引导 */\r\n    public guide: GameGuide = undefined;\r\n\r\n    /** 得分 */\r\n    private _score: number = 0;\r\n\r\n    /** 下一个要更新生成速度的分数值 */\r\n    private speedUpdateTarget: number = undefined;\r\n\r\n    /** 下一个更新球生成的概率的分数值 */\r\n    private oddsUpdateTarget: number = undefined;\r\n\r\n    /** 下一个更新重力加速度的分数值 */\r\n    private gravityUpdateTarget: number = undefined;\r\n\r\n    /** 触发疯狂模式分数值 */\r\n    private _crazyTarget: number = 0;\r\n\r\n    /** 疯狂模式持续时间 */\r\n    private crazyDuration: number = undefined;\r\n\r\n    /** 拖动球触发的球*/\r\n    private _triggerBall: Ball = undefined;\r\n\r\n    /** 暂停 */\r\n    private pauseFlag: boolean = false;\r\n\r\n    /** 疯狂模式 */\r\n    private crazyFlag: boolean = false;\r\n\r\n    /** 物理引擎 */\r\n    public physicsManager: cc.PhysicsManager = undefined;\r\n\r\n    onLoad() {\r\n        GameCtrl.instance = this;\r\n        this.physicsManager = cc.director.getPhysicsManager();\r\n        \r\n        this.physicsManager.enabled = true;\r\n        cc.PhysicsManager.POSITION_ITERATIONS = 20;\r\n    }\r\n\r\n    start() {\r\n        this.ballsCtr = new BallsCtrl();\r\n\r\n        //挂上生成球的脚本  \r\n        this.creatBall = this.node.addComponent(CreatBall);\r\n\r\n        this.addEventListener();\r\n        this.pointsTransformationGamePanel();\r\n        this.ballboom.zIndex = cc.macro.MAX_ZINDEX;\r\n\r\n        //暂停面板在动画层上面\r\n        this.pauseNode.zIndex = this.pauseNode.zIndex + 10;\r\n\r\n        MySound.instance.playAudio(AudioType.GameEnter);\r\n        let action = cc.sequence([\r\n            cc.delayTime(0.3),\r\n            cc.callFunc(() => {\r\n                this.gameInit();\r\n            })\r\n        ])\r\n        this.node.runAction(action);\r\n        this.playAnimation(this.cloudPrefab);\r\n\r\n        //进入游戏,开始操作记录\r\n        RootNode.instance.gameLog.startRecorder();\r\n\r\n        //如果有新手引导拉起遮罩\r\n        if (RootNode.instance.newPlayer) {\r\n            this.maskPanl.active = true;\r\n            this.maskPanl.opacity = 1;\r\n        }\r\n\r\n        this.updateRevivalTime();\r\n    }\r\n\r\n    /**\r\n     * 加分\r\n     */\r\n    public set addScore(num: number) {\r\n        this._score += num;\r\n\r\n        //疯狂模式不需要更新这些\r\n        if (!this.crazy) {\r\n            if (this._score > this.speedUpdateTarget)\r\n                this.updateCreatSpeed();\r\n            if (this._score > this.oddsUpdateTarget)\r\n                this.updateballOdds();\r\n            if (this._score > this.gravityUpdateTarget)\r\n                this.updateGravity();\r\n            this.updateCreazy();\r\n        }\r\n        let scoreDisplay = cc.sequence([\r\n            cc.delayTime(1),\r\n            cc.callFunc(() => {\r\n                this.scoreLable.string = this._score.toString();\r\n            })\r\n        ]);\r\n        this.node.runAction(scoreDisplay);\r\n    }\r\n\r\n    /**\r\n     * 获取分数\r\n     */\r\n    public get Score() {\r\n        return this._score;\r\n    }\r\n\r\n    public set physicsManagerEnable(enabled: boolean) {\r\n        if (this.physicsManager.enabled == enabled)\r\n            return;\r\n        this.physicsManager.enabled = enabled;\r\n    }\r\n\r\n    /**\r\n     * 设置触发球\r\n     */\r\n    public set triggerBall(ball: Ball) {\r\n        if (this._triggerBall)\r\n            this._triggerBall.setTrigger = false;\r\n        if (ball)\r\n            ball.setTrigger = true;\r\n        this._triggerBall = ball;\r\n    }\r\n\r\n    /**\r\n     * 获取触发球\r\n     */\r\n    public get triggerBall() {\r\n        return this._triggerBall;\r\n    }\r\n\r\n    /**\r\n     * 暂停\r\n     */\r\n    public pauseButton() {\r\n        this.pause = true;\r\n    }\r\n\r\n    /**\r\n     * 返回首界面\r\n     */\r\n    public HomeButton() {\r\n        //返回首界面发送操作日志\r\n        RootNode.instance.gameLog.sendAction();\r\n\r\n        MySound.instance.playAudio(AudioType.Button);\r\n        RootNode.instance.loadScene(\"home\");\r\n    }\r\n\r\n    /**\r\n     * 游戏暂停\r\n     */\r\n    public set pause(flag: boolean) {\r\n        MySound.instance.playAudio(AudioType.Button);\r\n        this.physicsManager.enabled = !flag;\r\n        this.pauseFlag = flag;\r\n        this.pauseNode.active = flag;\r\n        this.creatBall.pause = flag;\r\n\r\n        RootNode.instance.gameLog.recordAction(\"pause\");\r\n        //疯狂模式倒计时中,暂停继续倒计时\r\n        if (this.crazyProgressNode.active) {\r\n            let bar = this.crazyProgressNode.children[0];\r\n            if (flag)\r\n                bar.pauseAllActions();\r\n            else\r\n                bar.resumeAllActions();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 查看群排行暂停\r\n     */\r\n    public set groupPause(flag: boolean) {\r\n        //如果是游戏结束和暂停状态不需要暂停游戏\r\n        if (this.maskPanl.active || this.pauseNode.active)\r\n            return;\r\n        this.physicsManager.enabled = !flag;\r\n        this.pauseFlag = flag;\r\n        this.creatBall.pause = flag;\r\n    }\r\n\r\n    /**\r\n     * 获取是否是疯狂模式\r\n     */\r\n    public get crazy() {\r\n        return this.crazyFlag;\r\n    }\r\n\r\n    /**\r\n     * 疯狂模式延迟设置\r\n     * @param flag 是否疯狂模式\r\n     * @param delay 延迟时间\r\n     */\r\n    public crazyDelay(flag: boolean, delay: number = 0) {\r\n        let callback = () => {\r\n            this.crazy = flag;\r\n        }\r\n        this.scheduleOnce(callback, delay);\r\n    }\r\n\r\n    /**\r\n     * 设置疯狂模式\r\n     */\r\n    public set crazy(flag: boolean) {\r\n        this.crazyFlag = flag;\r\n        this.creatBall.stopCreat();\r\n        if (flag)\r\n            this.initCreazy();\r\n        else\r\n            this.creazyCutout();\r\n\r\n        let str = flag ? \"crazy_start\" : \"crazy_end\";\r\n        RootNode.instance.gameLog.recordAction(str);\r\n    }\r\n\r\n    /**\r\n     * 获取是否暂停\r\n     */\r\n    public get pause() {\r\n        return this.pauseFlag;\r\n    }\r\n\r\n    /**\r\n     * 游戏继续\r\n     */\r\n    public continue() {\r\n        this.pause = false;\r\n    }\r\n\r\n    /**\r\n     * 重玩\r\n     */\r\n    public replay() {\r\n        MySound.instance.playAudio(AudioType.Button);\r\n        this._score = 0;\r\n        this.updateRevivalTime();\r\n\r\n        //如果有新手引导结束新手引导\r\n        if (this.guide)\r\n            this.guide.guideEnd();\r\n        else {\r\n            this.clearBall();\r\n            this.gameInit();\r\n        }\r\n\r\n        this.revival.close();\r\n        this.pause = false;\r\n        this.gameFinish.open(false);\r\n        this.physicsManager.enabled = true;\r\n    }\r\n\r\n    /**\r\n     * 游戏结束,有复活次数弹复活\r\n     * @param delayTime 结束页出现时间\r\n     */\r\n    public gameOver(delayTime: number = 0) {\r\n        this.topStrip.stopJudgment();\r\n        this.creatBall.stopCreat();\r\n        this.setballDie();\r\n        this.physicsManager.enabled = false;\r\n        this.maskFadeIn();\r\n        let seq = cc.sequence([\r\n            cc.delayTime(delayTime),\r\n            cc.callFunc(() => {\r\n                if (this.revivalTime > 0)\r\n                    this.revival.open();\r\n                else\r\n                    this.gameFinish.open(true);\r\n            })\r\n        ]);\r\n        this.node.runAction(seq);\r\n    }\r\n\r\n    /**\r\n     * 获取游戏面板的球\r\n     */\r\n    public getGamePanelBall(): Array<Ball> {\r\n        let nodes = this.gamePanl.children;\r\n        let balls = [];\r\n        for (let i = 0; i < nodes.length; i++) {\r\n            if (!nodes[i].active)\r\n                continue;\r\n            let ball = nodes[i].getComponent(Ball);\r\n            if (ball)\r\n                balls.push(ball);\r\n        }\r\n        return balls;\r\n    }\r\n\r\n    /**\r\n     * 复活初始化\r\n     */\r\n    public revivalInit() {\r\n        //复活动画\r\n        this.playAnimation(this.revivalePrefab);\r\n        MySound.instance.playAudio(AudioType.PlayAgain);\r\n        let action = cc.sequence(\r\n            //7帧最亮的时候,清理球\r\n            cc.delayTime(11 / 30),\r\n            cc.callFunc(() => {\r\n                this.clearBall();\r\n            }),\r\n\r\n            //切换动画播放后,正常游戏\r\n            cc.delayTime(19 / 30),\r\n            cc.callFunc(() => {\r\n                this.gameInit();\r\n                this.physicsManager.enabled = true;\r\n            })\r\n        );\r\n        this.node.runAction(action);\r\n    }\r\n\r\n    /**\r\n     * 新手引导结束,初始化游戏\r\n     */\r\n    public guideEnd() {\r\n        this.maskPanl.active = false;\r\n        this.clearBall();\r\n        this.creatBall.initCreat();\r\n        this.guide = undefined;\r\n        this.physicsManagerEnable = true;\r\n    }\r\n\r\n    /**\r\n     * 遮罩渐显\r\n     */\r\n    private maskFadeIn() {\r\n        this.maskPanl.active = true;\r\n        this.maskPanl.opacity = 0;\r\n        let action = cc.fadeTo(1.5, 127);\r\n        this.maskPanl.runAction(action);\r\n    }\r\n\r\n    /**\r\n     * 底部碰撞体点坐标转换到游戏面板\r\n     */\r\n    private pointsTransformationGamePanel() {\r\n        let arr = this.bottomCollider.points;\r\n        let pos = this.bottomCollider.node.position;\r\n        for (let i = 0; i < arr.length; i++) {\r\n            let point = arr[i].clone();\r\n            point.addSelf(pos);\r\n            this.bottomPoints.push(point);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 监听手指移动\r\n     */\r\n    private addEventListener() {\r\n        this.gamePanl.on(cc.Node.EventType.TOUCH_MOVE, (e) => {\r\n            this.onTouchMove(e);\r\n        });\r\n\r\n        RootNode.instance.showGroup = (any) => {\r\n            this.charts.groupLunch(any);\r\n            this.groupPause = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 触碰移动处理\r\n     * @param touch 触碰事件\r\n     */\r\n    private onTouchMove(touch: cc.Event.EventTouch) {\r\n        if (this.slectBall == undefined)\r\n            return;\r\n        let pos = this.gamePanl.convertToNodeSpaceAR(touch.getLocation());\r\n        this.slectBall.movePos(pos);\r\n    }\r\n\r\n    /**\r\n     * 游戏初始化\r\n     */\r\n    private gameInit() {\r\n        RootNode.instance.triggerGC();\r\n        this._crazyTarget = 0;\r\n        this.creatBall.crazyTrigerNum = undefined;\r\n        this.updateCreazy();\r\n        this.updateCreatSpeed();\r\n        this.updateballOdds();\r\n        this.updateGravity();\r\n        this.ballsCtr.reset();\r\n        this.scoreLable.string = this._score.toString();\r\n        this.topStrip.endJudgment();\r\n        this.isNewPlayer();\r\n    }\r\n\r\n    /**\r\n     * 是否为新手\r\n     */\r\n    private isNewPlayer() {\r\n        //为新手开启新手引导\r\n        if (RootNode.instance.newPlayer) {\r\n            this.creatBall.guideCreat();\r\n            let node = cc.instantiate(this.guidePre);\r\n            node.parent = this.maskPanl.parent;\r\n            this.guide = node.getComponent(GameGuide);\r\n            this.guide.init();\r\n        } else\r\n            this.creatBall.initCreat();\r\n    }\r\n\r\n    /**\r\n     * 根据分数更新球生成速度\r\n     */\r\n    private updateCreatSpeed() {\r\n        let speedArr = GameConfig.getCreatInformation(this._score);\r\n        this.speedUpdateTarget = speedArr[1];\r\n        this.creatBall.creatSpeed = speedArr[0];\r\n    }\r\n\r\n    /**\r\n     * 根据分数更新重力,用于控制下落速度\r\n     */\r\n    private updateGravity() {\r\n        let grivityArr = GameConfig.getGravityInformation(this._score);\r\n        this.gravityUpdateTarget = grivityArr[1];\r\n        this.physicsManager.gravity = new cc.Vec2(0, -grivityArr[0]);\r\n    }\r\n\r\n    /**\r\n     * 根据分数更新球生成的概率\r\n     */\r\n    private updateballOdds() {\r\n        let oddsArr = GameConfig.getOddsInformation(this._score);\r\n        this.oddsUpdateTarget = oddsArr[1];\r\n        this.creatBall.updateOddsMap(oddsArr[0]);\r\n    }\r\n\r\n    /**\r\n    * 根据分数进入Crazy模式\r\n    */\r\n    private updateCreazy() {\r\n        //生成球正在判断中,等判断结束,再更新\r\n        if (this.creatBall.crazyTrigerNum != undefined)\r\n            return;\r\n        if (this._crazyTarget > this._score)\r\n            return;\r\n        let creazyArr = GameConfig.getCrazyInformation(this._score);\r\n        this._crazyTarget = creazyArr[0];\r\n        this.creatBall.crazyTrigerNum = creazyArr[0];\r\n\r\n        //解析值 20|50|20%|0.75|1250|1:4%,2:4%,3:4%,4:4%,5:80%,6:1%,7:1%,8:1%,9:1% 持续时间 合成得分 概率 重力 球生成概率\r\n        let value = creazyArr[1].replace('%', '');\r\n        let arr = value.split(\"|\");\r\n        this.crazyDuration = arr[0];\r\n        this.creatBall.crazyTrigerOdds = arr[2] / 100;\r\n    }\r\n\r\n    /**\r\n     * 疯狂模式初始化\r\n     */\r\n    private initCreazy() {\r\n        //进场动画\r\n        this.playAnimation(this.crazyCutToPrefab);\r\n        MySound.instance.playAudio(AudioType.CrazyFive);\r\n        let action = cc.sequence(\r\n            //7帧最亮的时候,清理球\r\n            cc.delayTime(7 / 30),\r\n            cc.callFunc(() => {\r\n                this.clearBall();\r\n                this.crazyUiChange();\r\n            }),\r\n            //切换动画播放后,开始疯狂模式\r\n            cc.delayTime(23 / 30),\r\n            cc.callFunc(() => {\r\n                this.creazyProgress();\r\n                this.creazyCutIn();\r\n            })\r\n        );\r\n        this.node.runAction(action);\r\n    }\r\n\r\n    /** \r\n     * 疯狂模式切入\r\n    */\r\n    private creazyCutIn() {\r\n        //解析值 20|50|20%|0.75|1250|1:4%,2:4%,3:4%,4:4%,5:80%,6:1%,7:1%,8:1%,9:1% 持续时间 合成得分 概率 重力 球生成概率\r\n        let value = GameConfig.getcrazyInitValue(this.Score);\r\n        let arr = value.split(\"|\");\r\n        this.crazyComboAdd = parseInt(arr[1]);\r\n        this.creatBall.creatSpeed = Number(arr[3]);\r\n        this.physicsManager.gravity = new cc.Vec2(0, -arr[4]);\r\n        this.creatBall.updateOddsMap(arr[5]);\r\n        this.creatBall.initCreat();\r\n        this.topStrip.endJudgment();\r\n    }\r\n\r\n    /**\r\n     * 疯狂模式退出\r\n     */\r\n    private creazyCutout() {\r\n        //疯狂模式结束,防止合球\r\n        this.maskPanl.active = true;\r\n        this.maskPanl.opacity = 1;\r\n\r\n        //停掉死亡检测\r\n        this.topStrip.stopJudgment();\r\n        this.playAnimation(this.crazyCutOutPrefab);\r\n        this.crazyProgressNode.active = false;\r\n        let action = cc.sequence(\r\n            //14帧最亮的时候,清理球\r\n            cc.delayTime(14 / 30),\r\n            cc.callFunc(() => {\r\n                this.clearBall();\r\n                this.creatBall.crazyPoolClear();\r\n                this.crazyUiChange();\r\n            }),\r\n\r\n            //切换动画播放后,正常游戏\r\n            cc.delayTime(8 / 30),\r\n            cc.callFunc(() => {\r\n                this.maskPanl.active = false;\r\n                this.gameInit();\r\n                this.physicsManager.enabled = true;\r\n            })\r\n        );\r\n        this.node.runAction(action);\r\n    }\r\n\r\n    /**\r\n     * 疯狂模式进度条\r\n     */\r\n    private creazyProgress() {\r\n        let time = this.crazyDuration;\r\n        this.crazyProgressNode.active = true;\r\n        let bar = this.crazyProgressNode.children[0];\r\n        let sprite = bar.getComponent(cc.Sprite);\r\n\r\n        bar.stopAllActions();\r\n        sprite.spriteFrame = this.barImArr[0];\r\n        bar.scale = 1;\r\n        let action = cc.sequence(\r\n            cc.scaleTo(time * 0.75, 0.25, 1),\r\n            cc.callFunc(() => {\r\n                sprite.spriteFrame = this.barImArr[1];\r\n            }),\r\n            cc.scaleTo(time * 0.25, 0, 1),\r\n            cc.callFunc(() => {\r\n                this.crazyProgressNode.active = false;\r\n                this.crazy = false;\r\n            })\r\n        )\r\n        bar.runAction(action);\r\n    }\r\n\r\n    /**\r\n     * 疯狂模式切换,ui改变\r\n     */\r\n    private crazyUiChange() {\r\n        let num = this.crazy ? 1 : 0;\r\n        //界面的设置\r\n        this.gamePanl.getComponent(cc.Sprite).spriteFrame = this.gameBgImArr[num];\r\n        this.topSprte.spriteFrame = this.topPauseImArr[num];\r\n        this.bottomCollider.node.getComponent(cc.Sprite).spriteFrame = this.bottomImArr[num];\r\n        this.bgFitSprite.spriteFrame = this.bgFitImArr[num];\r\n        let topNode = this.topStrip.node;\r\n        topNode.getComponent(cc.Sprite).spriteFrame = this.topImArr[num];\r\n\r\n        let positionY = this.crazy ? 450 : 500;\r\n        topNode.setPosition(0, positionY);\r\n\r\n        MySound.instance.setCrazyBgm(this.crazy);\r\n    }\r\n\r\n\r\n    /**\r\n     * 死亡闭眼\r\n     */\r\n    private setballDie() {\r\n        let childs = this.getGamePanelBall();\r\n        let length = childs.length;\r\n        for (let i = 0; i < length; i++) {\r\n            let ball = childs[i];\r\n            ball.setEyeState(EyeState.die);\r\n        }\r\n    }\r\n\r\n    /**\r\n    * 界面上的球清理\r\n    */\r\n    private clearBall() {\r\n        this.ballboom.active = false;\r\n        let childs = this.getGamePanelBall();\r\n        let length = childs.length;\r\n        for (let i = 0; i < length; i++) {\r\n            let ball = childs[i];\r\n            this.creatBall.ballRecovery(ball);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 播放动画\r\n     * @param prefab 带有动画的预制体\r\n     * @param time 销毁时间为0就为动画时长\r\n     */\r\n    private playAnimation(prefab: cc.Prefab, time: number = 0): cc.Node {\r\n        let node = cc.instantiate(prefab);\r\n        node.parent = this.maskPanl.parent;\r\n        //层次在游戏层上面\r\n        node.zIndex = 1;\r\n        let animation = node.getComponent(cc.Animation);\r\n        let animState = animation.play();\r\n        time = time == 0 ? animState.duration : time;\r\n        //销毁\r\n        this.scheduleOnce(() => {\r\n            node.removeFromParent();\r\n        }, time)\r\n        return node;\r\n    }\r\n\r\n    private updateRevivalTime()\r\n    {\r\n        if(this.revival.canRevival())\r\n            this.revivalTime = 1;\r\n        else\r\n            this.revivalTime = 0;\r\n    }\r\n\r\n}"]}