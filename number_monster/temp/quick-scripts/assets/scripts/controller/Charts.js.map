{"version":3,"sources":["Charts.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\controller","sourcesContent":["// Copyright (C) 2019, Flickering Inc. All rights reserved.\r\n// Author: hongchangfu (hongchangfu@flickering.ai)\r\n\r\n//排行榜\r\n\r\nimport MySound, { AudioType } from \"../MySound\";\r\nimport RootNode, { postMessageName } from \"../RootNode\";\r\nimport GameCtrl from \"./GameCtrl\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst enum Type {\r\n    charts = 0,    //排行榜\r\n    group = 1,     //群排行\r\n}\r\n\r\n@ccclass\r\nexport default class Charts extends cc.Component {\r\n    @property({ type: cc.Node, visible: true, displayName: \"查看群排行\" })\r\n    private groupNode: cc.Node = undefined;\r\n\r\n    @property({ type: cc.Node, visible: true, displayName: \"排行榜返回\" })\r\n    public chartsBackBtn: cc.Node = undefined;\r\n\r\n    @property({ type: cc.Node, visible: true, displayName: \"箭头\" })\r\n    public arrowNote: cc.Node = undefined;\r\n\r\n    @property({ type: [cc.SpriteFrame], visible: true, displayName: \"群排行按钮图片\" })\r\n    public spriteArr: Array<cc.SpriteFrame> = [];\r\n\r\n    @property({ type: cc.Label, visible: true, displayName: \"群分享上的文字\" })\r\n    public btnLable: cc.Label = undefined;\r\n\r\n    @property({ type: cc.Label, visible: true, displayName: \"标题\" })\r\n    public title: cc.Label = undefined\r\n\r\n    /** 状态:有排行榜和群排行两种 */\r\n    private type: Type = Type.charts;\r\n\r\n    /** 发送给开放域的消息类型 */\r\n    private messageType: string = undefined;\r\n\r\n    /** 发送给开放域的值,群排行有 */\r\n    private messageValue: string = undefined;\r\n\r\n    /** 退出回调 */\r\n    private outCallback: boolean = false;\r\n\r\n\r\n    start() {\r\n        this.node.zIndex = 11;\r\n        this.groupNode.on(\"click\", () => {\r\n            MySound.instance.playAudio(AudioType.Button);\r\n            if (this.type == Type.charts)\r\n                RootNode.instance.onLookGroupBtnClicked();\r\n            else //群排行\r\n            {\r\n                RootNode.instance.postMessage(postMessageName.chartsBack, undefined);\r\n                this.outCallback = true;\r\n                //首界面\r\n                if (RootNode.currentScene == \"home\")\r\n                    RootNode.instance.loadScene(\"game\");\r\n                else//游戏界面\r\n                {\r\n                    this.node.active = false;\r\n                    GameCtrl.instance.replay();\r\n                }\r\n            }\r\n        })\r\n\r\n        this.chartsBackBtn.on(\"click\", () => {\r\n            RootNode.instance.postMessage(postMessageName.chartsBack, RootNode.currentScene);\r\n            this.node.active = false;\r\n            this.outCallback = true;\r\n            MySound.instance.playAudio(AudioType.Button);\r\n            this.setType(Type.charts);\r\n\r\n            //如果是游戏界面\r\n            if (RootNode.currentScene == \"game\")\r\n                GameCtrl.instance.groupPause = false;\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 设置状态\r\n     * @param type 状态\r\n     */\r\n    private setType(type: Type) {\r\n        if (this.type == type)\r\n            return;\r\n        if (type == Type.charts) {\r\n            this.title.string = \"排行榜\";\r\n            this.btnLable.string = \"查看群排行\";\r\n        } else {\r\n            this.btnLable.string = \"我也要挑战\";\r\n            this.title.string = \"群排行榜\";\r\n        }\r\n        this.type = type;\r\n        this.arrowNote.active = type != Type.charts;\r\n        this.btnLable.node.position = type == Type.charts ? cc.Vec2.ZERO : new cc.Vec2(-18, 0);\r\n        this.groupNode.getComponent(cc.Sprite).spriteFrame = type == Type.charts ? this.spriteArr[0] : this.spriteArr[1];\r\n    }\r\n\r\n    /**\r\n     * 面板打开\r\n     * @param enable \r\n     */\r\n    public open() {\r\n        this.node.active = true;\r\n        this.messageType = postMessageName.charts;\r\n        this.messageValue = undefined;\r\n        this.postMessage();\r\n    }\r\n\r\n    /**\r\n     * 群分享进入\r\n     */\r\n    public async groupLunch(ticket: string) {\r\n        this.setType(Type.group);\r\n        this.node.active = true;\r\n        this.messageType = postMessageName.group;\r\n        this.messageValue = ticket;\r\n        this.postMessage();\r\n    }\r\n\r\n    /**\r\n     * 发送消息,加入初始化判定\r\n     */\r\n    public postMessage() {\r\n        let time = 0;\r\n\r\n        //游戏结束时,结算界面隐藏\r\n        RootNode.instance.postMessage(postMessageName.finishHide, undefined);\r\n\r\n        this.outCallback = false;\r\n        let callback = () => {\r\n\r\n            if (this.outCallback) {\r\n                this.unschedule(callback);\r\n                return;\r\n            }\r\n\r\n            time += 0.1;\r\n            //等待两秒,超时处理\r\n            if (time > 2) {\r\n                RootNode.instance.InitTimeOut(this);\r\n                this.unschedule(callback);\r\n            }\r\n\r\n            //初始化成功,且面板是打开的,发送消息给开放域\r\n            if (RootNode.instance.initSuccess) {\r\n                RootNode.instance.postMessage(this.messageType, this.messageValue);\r\n                this.unschedule(callback);\r\n            }\r\n        }\r\n        this.schedule(callback, 0.1);\r\n    }\r\n}"]}